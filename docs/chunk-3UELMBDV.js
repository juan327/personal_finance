import{a as z,b as _,c as j,d as B,e as L,f as U,g as J,h as K,i as Q,j as W,k as X,l as Y,m as Z,n as ee,o as te,p as ne,q as oe}from"./chunk-4ZNM5ZSZ.js";import{a as A,b as de,c as G,d as q,e as $}from"./chunk-JGHIACZH.js";import{$a as h,Ea as I,Fb as v,Gb as V,Hb as R,Ja as y,Mb as S,Nb as H,Qa as b,Sa as w,Ta as k,Ua as D,V as f,Va as N,Wa as o,Xa as t,Ya as u,_a as M,ab as s,ba as C,ca as x,d as se,eb as a,fb as g,gb as O,hb as F,jb as P,kb as E,lb as p,va as l}from"./chunk-KAWPYN6Y.js";var re=se(de());function pe(r,i){if(r&1){let e=M();o(0,"div",8)(1,"h2"),a(2,"Historial"),t(),o(3,"button",9),h("click",function(){C(e);let c=s();return x(c.openModal())}),a(4,"Agregar gasto"),t()()}}function ge(r,i){r&1&&(o(0,"tr")(1,"th"),a(2,"Categor\xEDa"),t(),o(3,"th"),a(4,"Nombre"),t(),o(5,"th"),a(6,"Monto"),t(),o(7,"th"),a(8,"Fecha"),t(),o(9,"th"),a(10,"Descripci\xF3n"),t(),o(11,"th"),a(12,"Creaci\xF3n"),t()())}function _e(r,i){if(r&1&&(o(0,"tr")(1,"td"),a(2),t(),o(3,"td"),a(4),t(),o(5,"td"),a(6),t(),o(7,"td"),a(8),P(9,"date"),t(),o(10,"td"),a(11),t(),o(12,"td"),a(13),P(14,"date"),t()()),r&2){let e=i.$implicit,n=s();l(2),g(e.categoryName),l(2),g(e.name),l(2),O("$",n._genericService.convertToCurrencyFormat(e.amount).data,""),l(2),g(E(9,6,e.date,"dd/MM/yyyy hh:mm a")),l(3),g(e.description),l(2),g(E(14,9,e.created,"dd/MM/yyyy hh:mm a"))}}function ue(r,i){if(r&1){let e=M();o(0,"button",9),h("click",function(){C(e);let c=s();return x(c.openModal())}),a(1,"Agregar ingreso"),t()}}function fe(r,i){r&1&&(o(0,"h2"),a(1,"Agregar gasto"),t())}function Ce(r,i){if(r&1&&(o(0,"option",22),a(1),t()),r&2){let e=i.$implicit;b("value",e.categoryId),l(),g(e.name)}}function xe(r,i){if(r&1&&(o(0,"div",12)(1,"div",13)(2,"label",14),a(3,"Nombre"),t(),u(4,"input",15),t(),o(5,"div",13)(6,"label",16),a(7,"Cantidad"),t(),u(8,"partial-inputnumber",17),t(),o(9,"div",13)(10,"label",18),a(11,"Fecha"),t(),u(12,"input",19),t(),o(13,"div",13)(14,"label",20),a(15,"Categor\xEDa"),t(),o(16,"select",21),D(17,Ce,2,2,"option",22,k),t()(),o(19,"div",13)(20,"label",23),a(21,"Descripci\xF3n"),t(),u(22,"textarea",24),t()()),r&2){let e=s(2);l(17),N(e._categories)}}function be(r,i){if(r&1&&(o(0,"button",25),a(1,"Agregar"),t()),r&2){let e=s(2);b("disabled",e._form.invalid)}}function he(r,i){if(r&1){let e=M();o(0,"form",10),h("ngSubmit",function(){C(e);let c=s();return x(c.submitForm(c._form))}),o(1,"partial-modal",11),h("eventCloseModal",function(){C(e);let c=s();return x(c.closeModal())}),y(2,fe,2,0,"ng-template",null,1,p)(4,xe,23,0,"ng-template",null,2,p)(6,be,2,1,"ng-template",null,3,p),t()()}if(r&2){let e=s();b("formGroup",e._form)}}re.setOptions(q);var ie=class r{constructor(){}_genericService=f(S);_highchartService=f(G);_indexeddbService=f(H);_modals={income:!1};_fb=f(Y);_form=null;_incomes=[];_categories=[];chart=null;_categoryType=2;ngOnInit(){let i=this._genericService.getDataTest();this._indexeddbService.getAllItems("categories","name","asc").then(e=>{e.length>0&&(this._categories=e.filter(n=>n.type===this._categoryType),this.loadTable())},e=>{console.error(e)})}ngAfterViewInit(){}ngAfterContentInit(){}ngOnDestroy(){}loadTable(){this._indexeddbService.getAllItems("transactions","created","asc").then(i=>{i.length>0&&(this._incomes=i.filter(n=>n.category.type===this._categoryType).map(n=>({transactionId:n.transactionId,name:n.name,amount:n.amount,date:n.date,description:n.description,categoryId:n.categoryId,categoryName:n.category.name,categoryType:n.category.type,created:n.created})));let e=this.getChartOptions();this._incomes.length>1&&this.chart!==null?this._highchartService.updateChart(this.chart,e):this.chart=this._highchartService.buildChart("container",e)},i=>{console.error(i)})}openModal(){this._form=this._fb.group({name:["",[_.required,_.minLength(3),_.maxLength(20)]],amount:["",[_.required,oe(2)]],date:[this._genericService.transformDateToString(this._genericService.getDateTimeNowUtc()),_.required],categoryId:[this._categories[0].categoryId,_.required],description:[""]}),this._modals.income=!0}closeModal(){this._modals.income=!1,this._form=null}submitForm(i){let e=i.value,n=this._genericService.parseNumber(e.amount.replace(".",""));if(!n.confirmation){alert(n.message);return}let c=this._categories.find(d=>d.categoryId===e.categoryId&&d.type===this._categoryType);if(c===void 0){alert("No se encontr\xF3 la categor\xEDa");return}let m={transactionId:this._genericService.generateGuid(),name:e.name,amount:n.data,date:new Date(e.date),description:e.description,categoryId:e.categoryId,category:c,created:new Date};this._indexeddbService.addItem("transactions",m).then(d=>{this._modals.income=!1,this.loadTable()},d=>{console.error(d)})}getTotal(){return this._incomes.reduce((i,e)=>i+e.amount,0)}getChartOptions(){let i=[],e=this._incomes.reduce((c,m)=>c+m.amount,0);for(let c=0;c<this._categories.length;c++){let m=this._categories[c],d=this._incomes.reduce((me,T)=>me+(T.categoryId===m.categoryId?T.amount:0),0),ae=this._genericService.convertToCurrencyFormat(d).data,ce=e>0?d*100/e:0,le=this._genericService.parseNumber(ce.toFixed(2)).data;i.push({id:m.categoryId,name:`${m.name} ($${ae})`,y:le,selected:!1,sliced:!1})}let n=i.reduce((c,m)=>c.y>m.y?c:m);return n.name=`<b style="color: var(--color-green); font-size: 0.9rem;">${n.name}</b>`,{title:{text:"Distribuci\xF3n de gastos"},subtitle:{text:this._incomes.length>0?"":"Sin datos"},tooltip:{valueSuffix:"%"},series:this._incomes.length>0?[{type:"pie",name:"Porcentaje",showInLegend:!0,data:i}]:[]}}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=I({type:r,selectors:[["app-expenses"]],features:[F([S,v,V])],decls:15,vars:3,consts:[["caption",""],["header",""],["body",""],["footer",""],[1,"card"],[3,"_values"],["id","container"],[3,"formGroup"],[1,"buttons"],["type","button",1,"btn","success",3,"click"],[3,"ngSubmit","formGroup"],[3,"eventCloseModal"],[1,"form"],[1,"form-group"],["for","name"],["type","text","formControlName","name","id","name","name","name","autocomplete","off","required",""],["for","amount"],["formControlName","amount","autocomplete","off"],["for","date"],["type","date","formControlName","date","id","date","name","date","autocomplete","off","required",""],["for","category"],["formControlName","categoryId","id","category","name","category","required",""],[3,"value"],["for","description"],["formControlName","description","id","description","name","description","autocomplete","off"],["type","submit",1,"btn","success",3,"disabled"]],template:function(e,n){e&1&&(o(0,"section")(1,"div",4)(2,"partial-table",5),y(3,pe,5,0,"ng-template",null,0,p)(5,ge,13,0,"ng-template",null,1,p)(7,_e,15,12,"ng-template",null,2,p)(9,ue,2,0,"ng-template",null,3,p),t(),a(11),t(),o(12,"div",4),u(13,"div",6),t()(),y(14,he,8,1,"form",7)),e&2&&(l(2),b("_values",n._incomes),l(9),O(" TOTAL: $",n._genericService.convertToCurrencyFormat(n.getTotal()).data," "),l(3),w(n._modals.income&&n._form!==null?14:-1))},dependencies:[R,v,Z,L,Q,W,z,K,j,B,X,A,ee,U,J,te,ne,$],styles:["partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{width:100%;display:grid}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{padding:10px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{overflow:auto;max-height:400px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{background-color:var(--color-black);border:1px solid var(--color-black-border);min-width:100%;border-spacing:0;border-collapse:collapse;position:relative}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:var(--color-black);position:sticky;top:-1px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:10px;text-align:left;word-break:break-word;overflow-wrap:break-word}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background-color:var(--color-black-weight)}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:left;word-break:break-word;overflow-wrap:break-word}section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}section[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;align-items:center}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:20px;gap:5px;border-radius:10px;background-color:var(--color-black);border:1px solid var(--color-black-border)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.6rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{font-size:1.3rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.comment[_ngcontent-%COMP%]{font-size:.8rem;color:var(--color-black-text)}form[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}form[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1.1rem}"]})};export{ie as ExpensesComponent};
