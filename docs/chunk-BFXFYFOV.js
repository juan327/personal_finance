import{a as U,b as f,c as H,d as J,e as K,f as Q,g as X,h as Y,i as Z,j as ee,k as te,l as ne,m as ie,n as oe,o as ae,p as re,q as le}from"./chunk-ND2E57TF.js";import{a as z,b as G,c as N}from"./chunk-7A5JR2EX.js";import{$a as M,Ea as q,Ja as x,Nb as I,Ob as W,P as j,Pb as $,Qa as O,Ta as P,Ua as E,Ub as S,V as y,Va as w,Vb as A,Wa as D,Xa as r,Ya as a,Za as v,ab as _,ba as g,bb as p,ca as d,e as u,gb as s,hb as b,ib as h,lb as V,mb as k,nb as L,ob as B,qb as R,rb as F,sb as C,va as m}from"./chunk-JE4FXYSB.js";var T=class o{constructor(){}_indexeddbService=y(A);_genericService=y(S);_fb=y(ie);loadTable(n,e){return u(this,null,function*(){var t=new N;try{yield this._indexeddbService.getAllItems("categories","created","desc").then(i=>{if(i.total>0){let l=n.search.trim().toLowerCase();e=i.items.filter(c=>c.name.toLowerCase().includes(l)).map(c=>({categoryId:c.categoryId,name:c.name,type:c.type,created:c.created,isDefault:c.isDefault})),n.total=e.length}t.data={partialTableOptions:n,categories:e},t.confirmation=!0,t.message="Tabla cargada correctamente"},i=>{console.error(i)})}catch(i){console.error(i),t.message=i.message,t.exception=i.toString()}return t})}modalOpen(n,e=null){var t=new N;try{e!==null?t.data=this._fb.group({opc:["Edit"],opcLabel:["Editar"],categoryId:[e.categoryId,[f.required]],name:[e.name,[f.required,f.minLength(3),f.maxLength(20)]],type:[e.type,[f.required]]}):t.data=this._fb.group({opc:["Create"],opcLabel:["Crear"],name:["",[f.required,f.minLength(3),f.maxLength(20)]],type:[1,[f.required]]}),t.confirmation=!0,t.message="Modal abierto correctamente"}catch(i){console.error(i),t.message=i.message,t.exception=i.toString()}return t}createOrUpdate(n){return u(this,null,function*(){var e=new G;try{let t=n.value,i=this._genericService.parseNumber(t.type);if(!i.confirmation)return e.message=i.message,e.exception=i.exception,e;if(t.opc==="Edit")yield this._indexeddbService.getItem("categories",t.categoryId).then(l=>u(this,null,function*(){l.name=t.name,l.type=i.data,yield this._indexeddbService.updateItem("categories",l.categoryId,l).then(c=>{e.confirmation=!0,e.message="Categoria actualizada correctamente"},c=>{console.error(c),e.message=c.message,e.exception=c.toString()})}),l=>{console.error(l),e.message=l.message,e.exception=l.toString()});else{let l={categoryId:this._genericService.generateGuid(),name:t.name,type:i.data,created:this._genericService.getDateTimeNow(),isDefault:!1};yield this._indexeddbService.addItem("categories",l).then(c=>{e.confirmation=!0,e.message="Categoria creada correctamente"},c=>{console.error(c),e.message=c.message,e.exception=c.toString()})}}catch(t){console.error(t),e.message=t.message,e.exception=t.toString()}return e})}delete(n){return u(this,null,function*(){var e=new G;try{yield this._indexeddbService.deleteItem("categories",n).then(t=>{this._indexeddbService.getAllItems("transactions","created","desc").then(i=>{i.total>0&&i.items.filter(l=>l.categoryId===n).forEach(l=>u(this,null,function*(){yield this._indexeddbService.deleteItem("transactions",l.transactionId)}))},i=>{console.error(i),e.message=i.message,e.exception=i.toString()}),e.confirmation=!0,e.message="Categoria eliminada correctamente"},t=>{console.error(t),e.message=t.message,e.exception=t.toString()})}catch(t){console.error(t),e.message=t.message,e.exception=t.toString()}return e})}static \u0275fac=function(e){return new(e||o)};static \u0275prov=j({token:o,factory:o.\u0275fac,providedIn:"root"})};function me(o,n){if(o&1&&(r(0,"option",10),s(1),a()),o&2){let e=n.$implicit;O("value",e.value),m(),b(e.label)}}function pe(o,n){if(o&1&&(r(0,"option",10),s(1),a()),o&2){let e=n.$implicit;O("value",e.value),m(),b(e.label)}}function ge(o,n){if(o&1){let e=M();r(0,"div",15)(1,"h2"),s(2,"Categorias"),a(),r(3,"button",16),_("click",function(){g(e);let i=p();return d(i.onOpenModal())}),s(4,"Agregar categoria"),a(),r(5,"input",17),_("input",function(i){g(e);let l=p();return d(l.onSearch(i))}),a()()}}function de(o,n){o&1&&(r(0,"tr")(1,"th"),s(2,"Tipo"),a(),r(3,"th"),s(4,"Nombre"),a(),r(5,"th"),s(6,"Creaci\xF3n"),a(),r(7,"th"),s(8,"OPC"),a()())}function _e(o,n){if(o&1){let e=M();r(0,"div",18)(1,"button",19),_("click",function(){g(e);let i=p().$implicit,l=p();return d(l.onOpenModal(i))}),v(2,"i",20),a(),r(3,"button",21),_("click",function(){g(e);let i=p().$implicit,l=p();return d(l.onModalOpenDelete(i))}),v(4,"i",22),a()()}}function ue(o,n){if(o&1&&(r(0,"tr")(1,"td"),s(2),a(),r(3,"td"),s(4),a(),r(5,"td"),s(6),R(7,"date"),a(),r(8,"td"),x(9,_e,5,0,"div",18),a()()),o&2){let e=n.$implicit;m(2),b(e.type===1?"Ingreso":"Gasto"),m(2),b(e.name),m(2),b(F(7,4,e.created,"dd/MM/yyyy hh:mm a")),m(3),P(e.isDefault?-1:9)}}function Ce(o,n){if(o&1){let e=M();r(0,"strong"),s(1,"OPC:"),a(),r(2,"div",18)(3,"button",19),_("click",function(){g(e);let i=p().$implicit,l=p();return d(l.onOpenModal(i))}),v(4,"i",20),a(),r(5,"button",21),_("click",function(){g(e);let i=p().$implicit,l=p();return d(l.onModalOpenDelete(i))}),v(6,"i",22),a()()}}function fe(o,n){if(o&1&&(r(0,"ul")(1,"li")(2,"strong"),s(3,"Tipo:"),a(),s(4),a(),r(5,"li")(6,"strong"),s(7,"Nombre:"),a(),s(8),a(),r(9,"li")(10,"strong"),s(11,"Creaci\xF3n:"),a(),s(12),R(13,"date"),a(),r(14,"li"),x(15,Ce,7,0),a()()),o&2){let e=n.$implicit;m(4),h(" ",e.type===1?"Ingreso":"Gasto",""),m(4),h(" ",e.name,""),m(4),h(" ",F(13,4,e.created,"dd/MM/yyyy hh:mm a"),""),m(3),P(e.isDefault?-1:15)}}function be(o,n){if(o&1&&(r(0,"h2"),s(1),a()),o&2){let e,t=p(2);m(),h("",(e=t._form.get("opcLabel"))==null?null:e.value," categoria")}}function ye(o,n){if(o&1&&(r(0,"option",10),s(1),a()),o&2){let e=n.$implicit;O("value",e.value),m(),b(e.label)}}function xe(o,n){if(o&1&&(r(0,"div",6)(1,"div",7)(2,"label",25),s(3,"Nombre"),a(),v(4,"input",26),a(),r(5,"div",7)(6,"label",27),s(7,"Tipo"),a(),r(8,"select",28),w(9,ye,2,2,"option",10,E),a()()()),o&2){let e=p(2);m(9),D(e._categoryTypes)}}function Oe(o,n){if(o&1&&(r(0,"div",29)(1,"button",30),s(2),a()()),o&2){let e,t=p(2);m(),O("disabled",t._form.invalid),m(),b((e=t._form.get("opcLabel"))==null?null:e.value)}}function ve(o,n){if(o&1){let e=M();r(0,"form",23),_("ngSubmit",function(){g(e);let i=p();return d(i.onSubmitForm(i._form))}),r(1,"partial-modal",24),_("eventCloseModal",function(){g(e);let i=p();return d(i.onCloseModal())}),x(2,be,2,1,"ng-template",null,1,C)(4,xe,11,0,"ng-template",null,2,C)(6,Oe,3,2,"ng-template",null,4,C),a()()}if(o&2){let e=p();O("formGroup",e._form)}}function Me(o,n){o&1&&(r(0,"h2"),s(1,"Eliminar ingreso"),a())}function Pe(o,n){if(o&1&&(r(0,"h4"),s(1,"\xBFEst\xE1 seguro de que desea eliminar el ingreso "),r(2,"b"),s(3),a(),s(4,"?"),a()),o&2){let e=p(2);m(3),b(e._selectedCategory.name)}}function he(o,n){if(o&1){let e=M();r(0,"partial-modalconfirmation",31),_("eventOnSuccess",function(){g(e);let i=p();return d(i.onDelete(i._selectedCategory))})("eventOnCancel",function(){g(e);let i=p();return i._modals.deleteCategory=!1,d(i._selectedCategory=null)}),x(1,Me,2,0,"ng-template",null,1,C)(3,Pe,5,1,"ng-template",null,2,C),a()}}var ce=class o{constructor(){}_genericService=y(S);_configurationService=y(T);_categories=[];_selectedCategory=null;_selectedCurrency="$";_currencies=[{value:"$",label:"$ USD"},{value:"\u20AC",label:"\u20AC EUR"},{value:"S/.",label:"S/. PEN"}];_selectedLanguage="es";_languages=[{value:"en",label:"English"},{value:"es",label:"Espa\xF1ol"}];_partialTableOptions={search:"",skip:0,take:5,total:0};_form=null;_modals={category:!1,deleteCategory:!1};_categoryTypes=[{value:1,label:"Ingreso"},{value:2,label:"Gasto"}];_localStorage={currency:this._genericService.getLocalStorage("currency")||"$",language:this._genericService.getLocalStorage("language")||"es"};ngOnInit(){this._selectedCurrency=this._genericService.getLocalStorage("currency")||"$",this.loadTable()}ngAfterViewInit(){}ngAfterContentInit(){}ngOnDestroy(){}loadTable(){return u(this,null,function*(){let n=yield this._configurationService.loadTable(this._partialTableOptions,this._categories);n.confirmation&&(this._partialTableOptions=n.data.partialTableOptions,this._categories=n.data.categories)})}onOpenModal(n=null){var e=this._configurationService.modalOpen(this._categories,n);if(!e.confirmation){alert(e.message);return}this._form=e.data,this._selectedCategory=n,this._modals.category=!0}onCloseModal(){this._modals.category=!1}onSubmitForm(n){return u(this,null,function*(){var e=yield this._configurationService.createOrUpdate(n);if(!e.confirmation){alert(e.message);return}this._modals.category=!1,this.loadTable()})}onModalOpenDelete(n){this._selectedCategory=n,this._modals.deleteCategory=!0}onDelete(n){return u(this,null,function*(){let e=yield this._configurationService.delete(n.categoryId);if(!e.confirmation){alert(e.message);return}this._modals.deleteCategory=!1,this.loadTable()})}loadPartialTable(n){this._partialTableOptions=n,this.loadTable()}changePartialTable(n){this._partialTableOptions=n,this.loadTable()}onSearch(n){this._partialTableOptions.search=n.target.value,this.loadTable()}onChangeCurrency(n){this._genericService.setLocalStorage("currency",n.target.value)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=q({type:o,selectors:[["app-configuration"]],features:[B([T,S,I,W])],decls:29,vars:6,consts:[["caption",""],["header",""],["body",""],["bodyMobile",""],["footer",""],[1,"card"],[1,"form"],[1,"form-group"],["for","language"],["id","language","name","language","required","",3,"ngModelChange","ngModel"],[3,"value"],["for","currency"],["id","currency","name","currency","required","",3,"ngModelChange","change","ngModel"],[3,"eventOnLoad","eventOnChange","_values","_options"],[3,"formGroup"],[1,"caption"],["type","button",1,"btn","success",3,"click"],["type","text","placeholder","Busqueda rapida...",3,"input"],[1,"operations"],["type","button","title","Editar",1,"btn","primary",3,"click"],[1,"pi","pi-pen-to-square"],["type","button","title","Eliminar",1,"btn","danger",3,"click"],[1,"pi","pi-trash"],[3,"ngSubmit","formGroup"],[3,"eventCloseModal"],["for","name"],["type","text","formControlName","name","id","name","name","name","autocomplete","off","required",""],["for","type"],["formControlName","type","id","type","name","type","required",""],[1,"footer"],["type","submit",1,"btn","success",3,"disabled"],[3,"eventOnSuccess","eventOnCancel"]],template:function(e,t){if(e&1){let i=M();r(0,"section")(1,"div",5)(2,"h2"),s(3,"Configuraci\xF3n"),a(),r(4,"div",6)(5,"div",7)(6,"label",8),s(7,"Idioma"),a(),r(8,"select",9),L("ngModelChange",function(c){return g(i),k(t._selectedLanguage,c)||(t._selectedLanguage=c),d(c)}),w(9,me,2,2,"option",10,E),a()(),r(11,"div",7)(12,"label",11),s(13,"Divisa"),a(),r(14,"select",12),L("ngModelChange",function(c){return g(i),k(t._selectedCurrency,c)||(t._selectedCurrency=c),d(c)}),_("change",function(c){return g(i),d(t.onChangeCurrency(c))}),w(15,pe,2,2,"option",10,E),a()()(),v(17,"hr"),r(18,"partial-table",13),_("eventOnLoad",function(c){return g(i),d(t.loadPartialTable(c))})("eventOnChange",function(c){return g(i),d(t.changePartialTable(c))}),x(19,ge,6,0,"ng-template",null,0,C)(21,de,9,0,"ng-template",null,1,C)(23,ue,10,7,"ng-template",null,2,C)(25,fe,16,7,"ng-template",null,3,C),a()()(),x(27,ve,8,1,"form",14)(28,he,5,0,"partial-modalconfirmation")}e&2&&(m(8),V("ngModel",t._selectedLanguage),m(),D(t._languages),m(5),V("ngModel",t._selectedCurrency),m(),D(t._currencies),m(3),O("_values",t._categories)("_options",t._partialTableOptions),m(9),P(t._modals.category&&t._form!==null?27:-1),m(),P(t._modals.deleteCategory&&t._selectedCategory!==null?28:-1))},dependencies:[$,I,oe,Q,ee,te,U,Z,H,J,ne,K,ae,X,Y,re,z,le],styles:["partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{width:100%;display:grid;gap:10px;view-transition-name:partial-table}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{overflow:auto;max-height:400px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]{background-color:var(--color-black);border:1px solid var(--color-black-border);min-width:100%;border-spacing:0;border-collapse:collapse;position:relative}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:var(--color-black);position:sticky;top:-1px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:10px;text-align:left;word-break:break-word;overflow-wrap:break-word}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background-color:var(--color-black-weight)}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:left;word-break:break-word;overflow-wrap:break-word}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .partial-table-mobile[_ngcontent-%COMP%]{display:none;flex-direction:column;gap:10px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .partial-table-mobile[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding:10px;display:flex;flex-direction:column;gap:10px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .partial-table-mobile[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]:nth-child(odd){background-color:var(--color-black-weight)}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .partial-table-mobile[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;gap:10px}section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}section[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr auto 1fr;align-items:center;gap:10px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:20px;gap:20px;border-radius:10px;background-color:var(--color-black);border:1px solid var(--color-black-border)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.6rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1.1rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{font-size:1.3rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.comment[_ngcontent-%COMP%]{font-size:.8rem;color:var(--color-black-text)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .operations[_ngcontent-%COMP%]{display:flex;gap:5px;align-items:center;justify-content:center;font-size:1px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .operations[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px 10px;font-size:.8rem!important}.form[_ngcontent-%COMP%], .form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1.1rem}.footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"]})};export{ce as ConfigurationComponent};
