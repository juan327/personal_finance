import{a as U,b as ee,c as D,d as Y}from"./chunk-JJWUV2CK.js";import{a as q,c as E}from"./chunk-PBSUUAEE.js";import{$a as V,Ea as F,Ja as j,Mb as C,Nb as B,Ob as Z,P as k,Qa as N,Sa as R,Tb as y,Ub as J,V as T,Xa as t,Ya as n,Za as W,ab as A,ba as M,bb as z,ca as I,d as X,e as v,gb as i,hb as _,jb as x,kb as G,ob as $,qb as H,rb as w,sb as S,va as g}from"./chunk-KGC6DHRS.js";var Q=X(ee());var b=class p{constructor(){}_indexeddbService=T(J);_highchartService=T(D);_genericService=T(y);loadTable(a,o,e,c,d){return v(this,null,function*(){var s=new E;try{yield this._indexeddbService.getAllItems("transactions","created","desc").then(l=>{l.total>0&&(a.total=l.total,o=l.items.map(r=>({transactionId:r.transactionId,name:r.name,amount:r.amount,amountString:`${c.currency} ${this._genericService.convertToCurrencyFormat(r.amount).data}`,date:r.date,description:r.description,categoryId:r.categoryId,categoryName:r.category.name,categoryType:r.category.type,created:this._genericService.addMinutesToDate(r.created,c.minutesOfDifferenceTimeZone)})));let m=this.getChartOptions(o,c);m.confirmation?o.length>1&&d!==null?this._highchartService.updateChart(d,m.data):d=this._highchartService.buildChart("container",m.data):(s.message=m.message,s.exception=m.exception),s.data={partialTableOptions:a,transactions:o,categories:e,chart:d},s.confirmation=!0,s.message="Tabla cargada correctamente"},l=>{console.error(l)})}catch(l){console.error(l),s.message=l.message,s.exception=l.toString()}return s})}updateResults(a,o){var e=new E;try{let c=o.filter(u=>u.categoryType===1),d=o.filter(u=>u.categoryType===2),s=c.reduce((u,O)=>u+O.amount,0),l=d.reduce((u,O)=>u+O.amount,0),m=this._genericService.convertToCurrencyFormat(s);if(!m.confirmation)return alert(m.message),e;let r=this._genericService.convertToCurrencyFormat(l);if(!r.confirmation)return alert(r.message),e;let f=this._genericService.convertToCurrencyFormat(s-l);if(!f.confirmation)return alert(f.message),e;e.data={incomes:c,expenses:d,totalIncomes:m.data,totalExpenses:r.data,total:f.data,totalInt:s-l},e.confirmation=!0,e.message="Resultados cargados correctamente"}catch(c){console.error(c),e.message=c.message,e.exception=c.toString()}return e}getChartOptions(a,o){var e=new E;try{let c=[],d=[],s=this._genericService.getMonthsFromYear(2025);for(let m=0;m<s.length;m++){let r=s[m],f=a.reduce((P,h)=>P+(h.categoryType===1&&h.date>=r.dateStart&&h.date<=r.dateEnd?h.amount:0),0),u=a.reduce((P,h)=>P+(h.categoryType===2&&h.date>=r.dateStart&&h.date<=r.dateEnd?h.amount:0),0),O=this._genericService.convertToNumberDecimal(f);if(!O.confirmation)continue;let L=this._genericService.convertToNumberDecimal(u);L.confirmation&&(c.push({name:r.name,y:O.data}),d.push({name:r.name,y:L.data}))}let l=[{name:"Ingresos",data:c,color:"var(--color-green)"},{name:"Gastos",data:d,color:"var(--color-red)"}];e.data={chart:{type:"column"},title:{text:"Rendimiento del a\xF1o"},xAxis:{categories:s.map(m=>m.name),crosshair:!0,accessibility:{description:"Countries"}},yAxis:{min:0,title:{text:"A\xD1O 2025"}},plotOptions:{column:{pointPadding:.2,borderWidth:0}},tooltip:{valuePrefix:o.currency+" "},series:l},e.confirmation=!0,e.message="Opciones del gr\xE1fico cargadas correctamente"}catch(c){console.error(c),e.message=c.message,e.exception=c.toString()}return e}static \u0275fac=function(o){return new(o||p)};static \u0275prov=k({token:p,factory:p.\u0275fac,providedIn:"root"})};function ne(p,a){p&1&&(t(0,"h2"),i(1,"Ultimos movimientos"),n())}function ae(p,a){p&1&&(t(0,"tr")(1,"th"),i(2,"Categor\xEDa"),n(),t(3,"th"),i(4,"Nombre"),n(),t(5,"th"),i(6,"Monto"),n(),t(7,"th"),i(8,"Fecha"),n(),t(9,"th"),i(10,"Descripci\xF3n"),n(),t(11,"th"),i(12,"Creaci\xF3n"),n()())}function ie(p,a){if(p&1&&(t(0,"tr")(1,"td"),i(2),n(),t(3,"td"),i(4),n(),t(5,"td"),i(6),n(),t(7,"td"),i(8),H(9,"date"),n(),t(10,"td"),i(11),n(),t(12,"td"),i(13),H(14,"date"),n()()),p&2){let o=a.$implicit,e=z();R(o.categoryType===1?"income":"expense"),g(2),_(o.categoryName),g(2),_(o.name),g(2),G(" ",e._localStorage.currency," ",o.categoryType===1?"":"-","",e._genericService.convertToCurrencyFormat(o.amount).data," "),g(2),_(w(9,10,o.date,"dd/MM/yyyy hh:mm a")),g(3),_(o.description),g(2),_(w(14,13,o.created,"dd/MM/yyyy hh:mm a"))}}Q.setOptions(Y);var K=class p{constructor(){}_genericService=T(y);_highchartService=T(D);_homeService=T(b);_transactions=[];_categories=[];_results={incomes:[],expenses:[],totalIncomes:"0",totalExpenses:"0",total:"0",totalInt:0};_partialTableOptions={search:"",skip:0,take:5,total:0};_chart=null;_localStorage={currency:this._genericService.getLocalStorage("currency")||"$",language:this._genericService.getLocalStorage("language")||"es",minutesOfDifferenceTimeZone:-300};ngOnInit(){this.loadTable()}ngAfterViewInit(){}ngOnDestroy(){}loadTable(){return v(this,null,function*(){let a=yield this._homeService.loadTable(this._partialTableOptions,this._transactions,this._categories,this._localStorage,this._chart);a.confirmation&&(this._partialTableOptions=a.data.partialTableOptions,this._transactions=a.data.transactions,this._categories=a.data.categories,this._chart=a.data.chart,this.updateResults())})}updateResults(){return v(this,null,function*(){let a=yield this._homeService.updateResults(this._results,this._transactions);a.confirmation&&(this._results=a.data)})}loadPartialTable(a){this._partialTableOptions=a,this.loadTable()}changePartialTable(a){this._partialTableOptions=a,this.loadTable()}static \u0275fac=function(o){return new(o||p)};static \u0275cmp=F({type:p,selectors:[["app-home"]],features:[$([b,C,B,y])],decls:39,vars:9,consts:[["caption",""],["header",""],["body",""],[1,"card"],[1,"title"],[1,"balance"],[1,"comment"],[1,"balance","income"],[1,"balance","expense"],["id","container"],[3,"eventOnLoad","eventOnChange","_values"]],template:function(o,e){if(o&1){let c=V();t(0,"section")(1,"div",3)(2,"span",4),i(3,"Balance total"),n(),t(4,"h3",5),i(5),n(),t(6,"span",6),i(7,"+20.1% del mes pasado"),n()(),t(8,"div",3)(9,"span",4),i(10,"Ingresos del Mes"),n(),t(11,"h3",7),i(12),n(),t(13,"span",6),i(14,"+8.2% del mes pasado"),n()(),t(15,"div",3)(16,"span",4),i(17,"Gastos del Mes"),n(),t(18,"h3",8),i(19),n(),t(20,"span",6),i(21,"-4.5% del mes pasado"),n()(),t(22,"div",3)(23,"span",4),i(24,"Rendimiento"),n(),t(25,"h3",5),i(26,"+18.2%"),n(),t(27,"span",6),i(28,"+4.1% del mes pasado"),n()(),t(29,"div",3),W(30,"div",9),n(),t(31,"div",3)(32,"partial-table",10),A("eventOnLoad",function(s){return M(c),I(e.loadPartialTable(s))})("eventOnChange",function(s){return M(c),I(e.changePartialTable(s))}),j(33,ne,2,0,"ng-template",null,0,S)(35,ae,13,0,"ng-template",null,1,S)(37,ie,15,16,"ng-template",null,2,S),n()()()}o&2&&(g(4),R(e._results.totalInt>=0?"income":"expense"),g(),x(" ",e._localStorage.currency," ",e._results.total," "),g(7),x(" ",e._localStorage.currency," ",e._results.totalIncomes," "),g(7),x(" ",e._localStorage.currency," ",e._results.totalExpenses," "),g(13),N("_values",e._transactions))},dependencies:[Z,C,U,q],styles:["section[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:20px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:20px;gap:5px;border-radius:10px;background-color:var(--color-black);border:1px solid var(--color-black-border)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:is(:nth-child(5),:nth-child(6)){grid-column:span 2}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.6rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{font-size:1.3rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.comment[_ngcontent-%COMP%]{font-size:.8rem;color:var(--color-black-text)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .balance.income[_ngcontent-%COMP%]{color:var(--color-green)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .balance.expense[_ngcontent-%COMP%]{color:var(--color-red)}tr.income[_ngcontent-%COMP%]{background-color:#86efac33!important}tr.income[_ngcontent-%COMP%]:nth-child(odd){background-color:#47d47a33!important}tr.expense[_ngcontent-%COMP%]{background-color:#f663!important}tr.expense[_ngcontent-%COMP%]:nth-child(odd){background-color:#f003!important}"]})};export{K as HomeComponent};
