import{a as A,b as Y,c as z,d as j}from"./chunk-WBIR7ZZU.js";import{a as G}from"./chunk-7QTDYJDQ.js";import{$a as k,Ea as M,Ja as I,Mb as f,Nb as V,Ob as $,Qa as D,Sa as T,Tb as S,Ub as B,V as _,Xa as e,Ya as t,Za as H,ab as F,ba as C,bb as R,ca as O,d as W,gb as i,hb as h,ib as x,jb as w,ob as N,qb as b,rb as E,sb as v,va as s}from"./chunk-XMB6CGJJ.js";var U=W(Y());function q(m,o){m&1&&(e(0,"h2"),i(1,"Ultimos movimientos"),t())}function J(m,o){m&1&&(e(0,"tr")(1,"th"),i(2,"Categor\xEDa"),t(),e(3,"th"),i(4,"Nombre"),t(),e(5,"th"),i(6,"Monto"),t(),e(7,"th"),i(8,"Fecha"),t(),e(9,"th"),i(10,"Descripci\xF3n"),t(),e(11,"th"),i(12,"Creaci\xF3n"),t()())}function K(m,o){if(m&1&&(e(0,"tr")(1,"td"),i(2),t(),e(3,"td"),i(4),t(),e(5,"td"),i(6),t(),e(7,"td"),i(8),b(9,"date"),t(),e(10,"td"),i(11),t(),e(12,"td"),i(13),b(14,"date"),t()()),m&2){let a=o.$implicit,n=R();T(a.categoryType===1?"income":"expense"),s(2),h(a.categoryName),s(2),h(a.name),s(2),w("$",a.categoryType===1?"":"-","",n._genericService.convertToCurrencyFormat(a.amount).data,""),s(2),h(E(9,9,a.date,"dd/MM/yyyy hh:mm a")),s(3),h(a.description),s(2),h(E(14,12,a.created,"dd/MM/yyyy hh:mm a"))}}U.setOptions(j);var L=class m{constructor(){}_genericService=_(S);_highchartService=_(z);_indexeddbService=_(B);_transactions=[];_categories=[];_results={incomes:[],expenses:[],totalIncomes:"0",totalExpenses:"0",total:"0",totalInt:0};_options={search:"",skip:0,take:5,total:0};chart=null;ngOnInit(){this.loadTable()}ngAfterViewInit(){}ngOnDestroy(){}loadTable(){this._indexeddbService.getAllItems("transactions","created","desc").then(o=>{o.total>0&&(this._options.total=o.total,this._transactions=o.items.map(n=>({transactionId:n.transactionId,name:n.name,amount:n.amount,date:n.date,description:n.description,categoryId:n.categoryId,categoryName:n.category.name,categoryType:n.category.type,created:n.created})));let a=this.getChartOptions();this._transactions.length>1&&this.chart!==null?this._highchartService.updateChart(this.chart,a):this.chart=this._highchartService.buildChart("container",a),this.updateResults()},o=>{console.error(o)})}updateResults(){let o=this._transactions.filter(d=>d.categoryType===1),a=this._transactions.filter(d=>d.categoryType===2),n=o.reduce((d,g)=>d+g.amount,0),l=a.reduce((d,g)=>d+g.amount,0),c=this._genericService.convertToCurrencyFormat(n);if(!c.confirmation){alert(c.message);return}let r=this._genericService.convertToCurrencyFormat(l);if(!r.confirmation){alert(r.message);return}let u=this._genericService.convertToCurrencyFormat(n-l);if(!u.confirmation){alert(u.message);return}this._results.incomes=o,this._results.expenses=a,this._results.totalIncomes=c.data,this._results.totalExpenses=r.data,this._results.total=u.data,this._results.totalInt=n-l}getChartOptions(){let o=[],a=[],n=this._genericService.getMonthsFromYear(2025);for(let c=0;c<n.length;c++){let r=n[c],u=this._transactions.reduce((y,p)=>y+(p.categoryType===1&&p.date>=r.dateStart&&p.date<=r.dateEnd?p.amount:0),0),d=this._transactions.reduce((y,p)=>y+(p.categoryType===2&&p.date>=r.dateStart&&p.date<=r.dateEnd?p.amount:0),0),g=this._genericService.convertToNumberDecimal(u);if(!g.confirmation)continue;let P=this._genericService.convertToNumberDecimal(d);P.confirmation&&(o.push({name:r.name,y:g.data}),a.push({name:r.name,y:P.data}))}let l=[{name:"Ingresos",data:o,color:"var(--color-green)"},{name:"Gastos",data:a,color:"var(--color-red)"}];return console.log(l),{chart:{type:"column"},title:{text:"Rendimiento del a\xF1o"},xAxis:{categories:n.map(c=>c.name),crosshair:!0,accessibility:{description:"Countries"}},yAxis:{min:0,title:{text:"A\xD1O 2025"}},plotOptions:{column:{pointPadding:.2,borderWidth:0}},tooltip:{valuePrefix:"$"},series:l}}loadPartialTable(o){this._options=o,this.loadTable()}changePartialTable(o){this._options=o,this.loadTable()}static \u0275fac=function(a){return new(a||m)};static \u0275cmp=M({type:m,selectors:[["app-home"]],features:[N([f,V,S])],decls:39,vars:6,consts:[["caption",""],["header",""],["body",""],[1,"card"],[1,"title"],[1,"balance"],[1,"comment"],[1,"balance","income"],[1,"balance","expense"],["id","container"],[3,"eventOnLoad","eventOnChange","_values"]],template:function(a,n){if(a&1){let l=k();e(0,"section")(1,"div",3)(2,"span",4),i(3,"Balance total"),t(),e(4,"h3",5),i(5),t(),e(6,"span",6),i(7,"+20.1% del mes pasado"),t()(),e(8,"div",3)(9,"span",4),i(10,"Ingresos del Mes"),t(),e(11,"h3",7),i(12),t(),e(13,"span",6),i(14,"+8.2% del mes pasado"),t()(),e(15,"div",3)(16,"span",4),i(17,"Gastos del Mes"),t(),e(18,"h3",8),i(19),t(),e(20,"span",6),i(21,"-4.5% del mes pasado"),t()(),e(22,"div",3)(23,"span",4),i(24,"Rendimiento"),t(),e(25,"h3",5),i(26,"+18.2%"),t(),e(27,"span",6),i(28,"+4.1% del mes pasado"),t()(),e(29,"div",3),H(30,"div",9),t(),e(31,"div",3)(32,"partial-table",10),F("eventOnLoad",function(r){return C(l),O(n.loadPartialTable(r))})("eventOnChange",function(r){return C(l),O(n.changePartialTable(r))}),I(33,q,2,0,"ng-template",null,0,v)(35,J,13,0,"ng-template",null,1,v)(37,K,15,15,"ng-template",null,2,v),t()()()}a&2&&(s(4),T(n._results.totalInt>=0?"income":"expense"),s(),x("$",n._results.total,""),s(7),x("$",n._results.totalIncomes,""),s(7),x("$",n._results.totalExpenses,""),s(13),D("_values",n._transactions))},dependencies:[$,f,A,G],styles:["section[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:20px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:20px;gap:5px;border-radius:10px;background-color:var(--color-black);border:1px solid var(--color-black-border)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:is(:nth-child(5),:nth-child(6)){grid-column:span 2}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.6rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{font-size:1.3rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.comment[_ngcontent-%COMP%]{font-size:.8rem;color:var(--color-black-text)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .balance.income[_ngcontent-%COMP%]{color:var(--color-green)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .balance.expense[_ngcontent-%COMP%]{color:var(--color-red)}tr.income[_ngcontent-%COMP%]{background-color:#86efac33!important}tr.income[_ngcontent-%COMP%]:nth-child(odd){background-color:#47d47a33!important}tr.expense[_ngcontent-%COMP%]{background-color:#f663!important}tr.expense[_ngcontent-%COMP%]:nth-child(odd){background-color:#f003!important}"]})};export{L as HomeComponent};
