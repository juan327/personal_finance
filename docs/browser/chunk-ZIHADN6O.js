import{a as U,b as C,c as H,d as J,e as K,f as Q,g as X,h as Y,i as Z,j as ee,k as te,l as ne,m as ie,n as oe,o as ae,p as re,q as le}from"./chunk-ND2E57TF.js";import{a as A,b as L,c as R}from"./chunk-7A5JR2EX.js";import{$a as v,Ea as G,Ja as x,Nb as D,Ob as B,P as F,Pb as z,Qa as O,Ta as S,Ua as T,Ub as P,V as y,Va as E,Vb as $,Wa as w,Xa as a,Ya as r,Za as M,ab as u,ba as g,bb as m,ca as d,e as _,gb as s,hb as f,ib as N,lb as I,mb as V,nb as k,ob as j,qb as q,rb as W,sb as b,va as p}from"./chunk-JE4FXYSB.js";var h=class o{constructor(){}_indexeddbService=y($);_genericService=y(P);_fb=y(ie);loadTable(n,e){return _(this,null,function*(){var t=new R;try{yield this._indexeddbService.getAllItems("categories","created","desc").then(i=>{if(i.total>0){let c=n.search.trim().toLowerCase();e=i.items.filter(l=>l.name.toLowerCase().includes(c)).map(l=>({categoryId:l.categoryId,name:l.name,type:l.type,created:l.created,isDefault:l.isDefault})),n.total=e.length}t.data={partialTableOptions:n,categories:e},t.confirmation=!0,t.message="Tabla cargada correctamente"},i=>{console.error(i)})}catch(i){console.error(i),t.message=i.message,t.exception=i.toString()}return t})}modalOpen(n,e=null){var t=new R;try{e!==null?t.data=this._fb.group({opc:["Edit"],opcLabel:["Editar"],categoryId:[e.categoryId,[C.required]],name:[e.name,[C.required,C.minLength(3),C.maxLength(20)]],type:[e.type,[C.required]]}):t.data=this._fb.group({opc:["Create"],opcLabel:["Crear"],name:["",[C.required,C.minLength(3),C.maxLength(20)]],type:[1,[C.required]]}),t.confirmation=!0,t.message="Modal abierto correctamente"}catch(i){console.error(i),t.message=i.message,t.exception=i.toString()}return t}createOrUpdate(n){return _(this,null,function*(){var e=new L;try{let t=n.value,i=this._genericService.parseNumber(t.type);if(!i.confirmation)return e.message=i.message,e.exception=i.exception,e;if(t.opc==="Edit")yield this._indexeddbService.getItem("categories",t.categoryId).then(c=>_(this,null,function*(){c.name=t.name,c.type=i.data,yield this._indexeddbService.updateItem("categories",c.categoryId,c).then(l=>{e.confirmation=!0,e.message="Categoria actualizada correctamente"},l=>{console.error(l),e.message=l.message,e.exception=l.toString()})}),c=>{console.error(c),e.message=c.message,e.exception=c.toString()});else{let c={categoryId:this._genericService.generateGuid(),name:t.name,type:i.data,created:this._genericService.getDateTimeNow(),isDefault:!1};yield this._indexeddbService.addItem("categories",c).then(l=>{e.confirmation=!0,e.message="Categoria creada correctamente"},l=>{console.error(l),e.message=l.message,e.exception=l.toString()})}}catch(t){console.error(t),e.message=t.message,e.exception=t.toString()}return e})}delete(n){return _(this,null,function*(){var e=new L;try{yield this._indexeddbService.deleteItem("categories",n).then(t=>{this._indexeddbService.getAllItems("transactions","created","desc").then(i=>{i.total>0&&i.items.filter(c=>c.categoryId===n).forEach(c=>_(this,null,function*(){yield this._indexeddbService.deleteItem("transactions",c.transactionId)}))},i=>{console.error(i),e.message=i.message,e.exception=i.toString()}),e.confirmation=!0,e.message="Categoria eliminada correctamente"},t=>{console.error(t),e.message=t.message,e.exception=t.toString()})}catch(t){console.error(t),e.message=t.message,e.exception=t.toString()}return e})}static \u0275fac=function(e){return new(e||o)};static \u0275prov=F({token:o,factory:o.\u0275fac,providedIn:"root"})};function pe(o,n){if(o&1&&(a(0,"option",9),s(1),r()),o&2){let e=n.$implicit;O("value",e.value),p(),f(e.label)}}function me(o,n){if(o&1&&(a(0,"option",9),s(1),r()),o&2){let e=n.$implicit;O("value",e.value),p(),f(e.label)}}function ge(o,n){if(o&1){let e=v();a(0,"div",14)(1,"h2"),s(2,"Categorias"),r(),a(3,"button",15),u("click",function(){g(e);let i=m();return d(i.onOpenModal())}),s(4,"Agregar categoria"),r(),a(5,"input",16),u("input",function(i){g(e);let c=m();return d(c.onSearch(i))}),r()()}}function de(o,n){o&1&&(a(0,"tr")(1,"th"),s(2,"Tipo"),r(),a(3,"th"),s(4,"Nombre"),r(),a(5,"th"),s(6,"Creaci\xF3n"),r(),a(7,"th"),s(8,"OPC"),r()())}function _e(o,n){if(o&1){let e=v();a(0,"div",17)(1,"button",18),u("click",function(){g(e);let i=m().$implicit,c=m();return d(c.onOpenModal(i))}),M(2,"i",19),r(),a(3,"button",20),u("click",function(){g(e);let i=m().$implicit,c=m();return d(c.onModalOpenDelete(i))}),M(4,"i",21),r()()}}function ue(o,n){if(o&1&&(a(0,"tr")(1,"td"),s(2),r(),a(3,"td"),s(4),r(),a(5,"td"),s(6),q(7,"date"),r(),a(8,"td"),x(9,_e,5,0,"div",17),r()()),o&2){let e=n.$implicit;p(2),f(e.type===1?"Ingreso":"Gasto"),p(2),f(e.name),p(2),f(W(7,4,e.created,"dd/MM/yyyy hh:mm a")),p(3),S(e.isDefault?-1:9)}}function Ce(o,n){if(o&1&&(a(0,"h2"),s(1),r()),o&2){let e,t=m(2);p(),N("",(e=t._form.get("opcLabel"))==null?null:e.value," categoria")}}function fe(o,n){if(o&1&&(a(0,"option",9),s(1),r()),o&2){let e=n.$implicit;O("value",e.value),p(),f(e.label)}}function be(o,n){if(o&1&&(a(0,"div",5)(1,"div",6)(2,"label",24),s(3,"Nombre"),r(),M(4,"input",25),r(),a(5,"div",6)(6,"label",26),s(7,"Tipo"),r(),a(8,"select",27),E(9,fe,2,2,"option",9,T),r()()()),o&2){let e=m(2);p(9),w(e._categoryTypes)}}function ye(o,n){if(o&1&&(a(0,"div",28)(1,"button",29),s(2),r()()),o&2){let e,t=m(2);p(),O("disabled",t._form.invalid),p(),f((e=t._form.get("opcLabel"))==null?null:e.value)}}function Oe(o,n){if(o&1){let e=v();a(0,"form",22),u("ngSubmit",function(){g(e);let i=m();return d(i.onSubmitForm(i._form))}),a(1,"partial-modal",23),u("eventCloseModal",function(){g(e);let i=m();return d(i.onCloseModal())}),x(2,Ce,2,1,"ng-template",null,1,b)(4,be,11,0,"ng-template",null,2,b)(6,ye,3,2,"ng-template",null,3,b),r()()}if(o&2){let e=m();O("formGroup",e._form)}}function xe(o,n){o&1&&(a(0,"h2"),s(1,"Eliminar ingreso"),r())}function ve(o,n){if(o&1&&(a(0,"h4"),s(1,"\xBFEst\xE1 seguro de que desea eliminar el ingreso "),a(2,"b"),s(3),r(),s(4,"?"),r()),o&2){let e=m(2);p(3),f(e._selectedCategory.name)}}function Me(o,n){if(o&1){let e=v();a(0,"partial-modalconfirmation",30),u("eventOnSuccess",function(){g(e);let i=m();return d(i.onDelete(i._selectedCategory))})("eventOnCancel",function(){g(e);let i=m();return i._modals.deleteCategory=!1,d(i._selectedCategory=null)}),x(1,xe,2,0,"ng-template",null,1,b)(3,ve,5,1,"ng-template",null,2,b),r()}}var ce=class o{constructor(){}_genericService=y(P);_configurationService=y(h);_categories=[];_selectedCategory=null;_selectedCurrency="$";_currencies=[{value:"$",label:"$ USD"},{value:"\u20AC",label:"\u20AC EUR"},{value:"S/.",label:"S/. PEN"}];_selectedLanguage="es";_languages=[{value:"en",label:"English"},{value:"es",label:"Espa\xF1ol"}];_partialTableOptions={search:"",skip:0,take:5,total:0};_form=null;_modals={category:!1,deleteCategory:!1};_categoryTypes=[{value:1,label:"Ingreso"},{value:2,label:"Gasto"}];_localStorage={currency:this._genericService.getLocalStorage("currency")||"$",language:this._genericService.getLocalStorage("language")||"es"};ngOnInit(){this._selectedCurrency=this._genericService.getLocalStorage("currency")||"$",this.loadTable()}ngAfterViewInit(){}ngAfterContentInit(){}ngOnDestroy(){}loadTable(){return _(this,null,function*(){let n=yield this._configurationService.loadTable(this._partialTableOptions,this._categories);n.confirmation&&(this._partialTableOptions=n.data.partialTableOptions,this._categories=n.data.categories)})}onOpenModal(n=null){var e=this._configurationService.modalOpen(this._categories,n);if(!e.confirmation){alert(e.message);return}this._form=e.data,this._selectedCategory=n,this._modals.category=!0}onCloseModal(){this._modals.category=!1}onSubmitForm(n){return _(this,null,function*(){var e=yield this._configurationService.createOrUpdate(n);if(!e.confirmation){alert(e.message);return}this._modals.category=!1,this.loadTable()})}onModalOpenDelete(n){this._selectedCategory=n,this._modals.deleteCategory=!0}onDelete(n){return _(this,null,function*(){let e=yield this._configurationService.delete(n.categoryId);if(!e.confirmation){alert(e.message);return}this._modals.deleteCategory=!1,this.loadTable()})}loadPartialTable(n){this._partialTableOptions=n,this.loadTable()}changePartialTable(n){this._partialTableOptions=n,this.loadTable()}onSearch(n){this._partialTableOptions.search=n.target.value,this.loadTable()}onChangeCurrency(n){this._genericService.setLocalStorage("currency",n.target.value)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=G({type:o,selectors:[["app-configuration"]],features:[j([h,P,D,B])],decls:27,vars:6,consts:[["caption",""],["header",""],["body",""],["footer",""],[1,"card"],[1,"form"],[1,"form-group"],["for","language"],["id","language","name","language","required","",3,"ngModelChange","ngModel"],[3,"value"],["for","currency"],["id","currency","name","currency","required","",3,"ngModelChange","change","ngModel"],[3,"eventOnLoad","eventOnChange","_values","_options"],[3,"formGroup"],[1,"caption"],["type","button",1,"btn","success",3,"click"],["type","text","placeholder","Busqueda rapida...",3,"input"],[1,"operations"],["type","button","title","Editar",1,"btn","primary",3,"click"],[1,"pi","pi-pen-to-square"],["type","button","title","Eliminar",1,"btn","danger",3,"click"],[1,"pi","pi-trash"],[3,"ngSubmit","formGroup"],[3,"eventCloseModal"],["for","name"],["type","text","formControlName","name","id","name","name","name","autocomplete","off","required",""],["for","type"],["formControlName","type","id","type","name","type","required",""],[1,"footer"],["type","submit",1,"btn","success",3,"disabled"],[3,"eventOnSuccess","eventOnCancel"]],template:function(e,t){if(e&1){let i=v();a(0,"section")(1,"div",4)(2,"h2"),s(3,"Configuraci\xF3n"),r(),a(4,"div",5)(5,"div",6)(6,"label",7),s(7,"Idioma"),r(),a(8,"select",8),k("ngModelChange",function(l){return g(i),V(t._selectedLanguage,l)||(t._selectedLanguage=l),d(l)}),E(9,pe,2,2,"option",9,T),r()(),a(11,"div",6)(12,"label",10),s(13,"Divisa"),r(),a(14,"select",11),k("ngModelChange",function(l){return g(i),V(t._selectedCurrency,l)||(t._selectedCurrency=l),d(l)}),u("change",function(l){return g(i),d(t.onChangeCurrency(l))}),E(15,me,2,2,"option",9,T),r()()(),M(17,"hr"),a(18,"partial-table",12),u("eventOnLoad",function(l){return g(i),d(t.loadPartialTable(l))})("eventOnChange",function(l){return g(i),d(t.changePartialTable(l))}),x(19,ge,6,0,"ng-template",null,0,b)(21,de,9,0,"ng-template",null,1,b)(23,ue,10,7,"ng-template",null,2,b),r()()(),x(25,Oe,8,1,"form",13)(26,Me,5,0,"partial-modalconfirmation")}e&2&&(p(8),I("ngModel",t._selectedLanguage),p(),w(t._languages),p(5),I("ngModel",t._selectedCurrency),p(),w(t._currencies),p(3),O("_values",t._categories)("_options",t._partialTableOptions),p(7),S(t._modals.category&&t._form!==null?25:-1),p(),S(t._modals.deleteCategory&&t._selectedCategory!==null?26:-1))},dependencies:[z,D,oe,Q,ee,te,U,Z,H,J,ne,K,ae,X,Y,re,A,le],styles:["partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{width:100%;display:grid;gap:10px;view-transition-name:partial-table}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{overflow:auto;max-height:400px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]{background-color:var(--color-black);border:1px solid var(--color-black-border);min-width:100%;border-spacing:0;border-collapse:collapse;position:relative}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:var(--color-black);position:sticky;top:-1px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:10px;text-align:left;word-break:break-word;overflow-wrap:break-word}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background-color:var(--color-black-weight)}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:left;word-break:break-word;overflow-wrap:break-word}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .partial-table-mobile[_ngcontent-%COMP%]{display:none;flex-direction:column;gap:10px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .partial-table-mobile[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding:10px;display:flex;flex-direction:column;gap:10px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .partial-table-mobile[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]:nth-child(odd){background-color:var(--color-black-weight)}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .partial-table-mobile[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;gap:10px}section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}section[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr auto 1fr;align-items:center;gap:10px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:20px;gap:20px;border-radius:10px;background-color:var(--color-black);border:1px solid var(--color-black-border)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.6rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1.1rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{font-size:1.3rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.comment[_ngcontent-%COMP%]{font-size:.8rem;color:var(--color-black-text)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .operations[_ngcontent-%COMP%]{display:flex;gap:5px;align-items:center;justify-content:center;font-size:1px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .operations[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px 10px;font-size:.8rem!important}.form[_ngcontent-%COMP%], .form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1.1rem}.footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"]})};export{ce as ConfigurationComponent};
