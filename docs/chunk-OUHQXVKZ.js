import{a as Z,b as _,c as ee,d as te,e as ne,f as oe,g as ie,h as ae,i as re,j as ce,k as le,l as me,m as se,n as de,o as pe,p as _e,q as L}from"./chunk-4ZNM5ZSZ.js";import{a as J,b as xe,c as K,d as W,e as Y}from"./chunk-JGHIACZH.js";import{$a as p,Ea as M,Eb as Q,Fb as I,Gb as U,Hb as S,Ja as h,Mb as q,Nb as X,Qa as x,Sa as w,Ta as z,Ua as G,V as y,Va as $,Wa as i,Xa as o,Ya as f,Za as k,_a as O,ab as d,ba as g,bb as D,ca as u,cb as V,d as he,db as N,e as A,eb as c,fb as b,gb as P,ha as E,hb as B,jb as F,kb as R,lb as C,va as m,za as H}from"./chunk-KAWPYN6Y.js";var ue=he(xe());var Me=["header"],Pe=["body"];function Ie(r,t){r&1&&k(0)}function Se(r,t){r&1&&k(0)}var T=class r{constructor(){}templateHeader;templateBody;eventOnSuccess=new E;eventOnCancel=new E;_renderer=y(H);ngOnInit(){this._renderer.setStyle(document.body,"overflow","hidden")}ngAfterViewInit(){}ngAfterContentInit(){}ngOnDestroy(){this._renderer.setStyle(document.body,"overflow","auto")}onSuccess(){this.eventOnSuccess.emit()}onCancel(){this.eventOnCancel.emit()}closeModal(){this.eventOnCancel.emit()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=M({type:r,selectors:[["partial-modalconfirmation"]],contentQueries:function(e,n,a){if(e&1&&(D(a,Me,5),D(a,Pe,5)),e&2){let l;V(l=N())&&(n.templateHeader=l.first),V(l=N())&&(n.templateBody=l.first)}},outputs:{eventOnSuccess:"eventOnSuccess",eventOnCancel:"eventOnCancel"},decls:15,vars:2,consts:[[1,"content-modal"],[1,"modal"],[1,"header"],[1,"title"],[4,"ngTemplateOutlet"],[1,"close","pi","pi-times",3,"click"],[1,"body"],[1,"footer"],["type","button",1,"btn","danger",3,"click"],["type","button",1,"btn","success",3,"click"]],template:function(e,n){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),h(4,Ie,1,0,"ng-container",4),o(),i(5,"i",5),p("click",function(){return n.closeModal()}),o()(),f(6,"hr"),i(7,"div",6),h(8,Se,1,0,"ng-container",4),o(),f(9,"hr"),i(10,"div",7)(11,"button",8),p("click",function(){return n.onCancel()}),c(12,"NO"),o(),i(13,"button",9),p("click",function(){return n.onSuccess()}),c(14,"SI"),o()()()()),e&2&&(m(4),x("ngTemplateOutlet",n.templateHeader),m(4),x("ngTemplateOutlet",n.templateBody))},dependencies:[S,Q],styles:[".content-modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;z-index:1000;display:flex;justify-content:center;align-items:center;padding:10px;overflow:auto}.content-modal[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]{background-color:var(--color-black);border-radius:10px;border:1px solid var(--color-black-border);padding:20px;width:400px;max-width:100%;display:flex;flex-direction:column;gap:10px;animation:_ngcontent-%COMP%_showModal .3s ease}.content-modal[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:10px}.content-modal[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.content-modal[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.3rem}.content-modal[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]{cursor:pointer;transition:background-color .3s ease;color:var(--color-black-text);border-radius:150%;width:30px;height:30px;display:flex;align-items:center;justify-content:center}.content-modal[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]   .close[_ngcontent-%COMP%]:hover{background-color:var(--color-black-border)}.content-modal[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{margin:0;border:none;background-color:var(--color-black-border);height:1.5px}.content-modal[_ngcontent-%COMP%]   .modal[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:10px}@keyframes _ngcontent-%COMP%_showModal{0%{margin-top:-100px;opacity:0}to{margin-top:0;opacity:1}}"]})};function Te(r,t){if(r&1){let e=O();i(0,"div",8)(1,"h2"),c(2,"Historial"),o(),i(3,"button",9),p("click",function(){g(e);let a=d();return u(a.openModal())}),c(4,"Agregar ingreso"),o()()}}function Ee(r,t){r&1&&(i(0,"tr")(1,"th"),c(2,"Categor\xEDa"),o(),i(3,"th"),c(4,"Nombre"),o(),i(5,"th"),c(6,"Monto"),o(),i(7,"th"),c(8,"Fecha"),o(),i(9,"th"),c(10,"Descripci\xF3n"),o(),i(11,"th"),c(12,"Creaci\xF3n"),o(),i(13,"th"),c(14,"OPC"),o()())}function we(r,t){if(r&1){let e=O();i(0,"tr")(1,"td"),c(2),o(),i(3,"td"),c(4),o(),i(5,"td"),c(6),o(),i(7,"td"),c(8),F(9,"date"),o(),i(10,"td"),c(11),o(),i(12,"td"),c(13),F(14,"date"),o(),i(15,"td")(16,"div",10)(17,"button",11),p("click",function(){let a=g(e).$implicit,l=d();return u(l.openModal(a))}),f(18,"i",12),o(),i(19,"button",13),p("click",function(){let a=g(e).$implicit,l=d();return u(l.modalOpenDelete(a))}),f(20,"i",14),o()()()()}if(r&2){let e=t.$implicit,n=d();m(2),b(e.categoryName),m(2),b(e.name),m(2),P("$",n._genericService.convertToCurrencyFormat(e.amount).data,""),m(2),b(R(9,6,e.date,"dd/MM/yyyy hh:mm a")),m(3),b(e.description),m(2),b(R(14,9,e.created,"dd/MM/yyyy hh:mm a"))}}function ke(r,t){if(r&1){let e=O();i(0,"button",9),p("click",function(){g(e);let a=d();return u(a.openModal())}),c(1,"Agregar ingreso"),o()}}function De(r,t){if(r&1&&(i(0,"h2"),c(1),o()),r&2){let e,n=d(2);m(),P("",(e=n._form.get("opcLabel"))==null?null:e.value," ingreso")}}function Ve(r,t){if(r&1&&(i(0,"option",27),c(1),o()),r&2){let e=t.$implicit;x("value",e.categoryId),m(),b(e.name)}}function Ne(r,t){if(r&1&&(i(0,"div",17)(1,"div",18)(2,"label",19),c(3,"Nombre"),o(),f(4,"input",20),o(),i(5,"div",18)(6,"label",21),c(7,"Cantidad"),o(),f(8,"partial-inputnumber",22),o(),i(9,"div",18)(10,"label",23),c(11,"Fecha"),o(),f(12,"input",24),o(),i(13,"div",18)(14,"label",25),c(15,"Categor\xEDa"),o(),i(16,"select",26),G(17,Ve,2,2,"option",27,z),o()(),i(19,"div",18)(20,"label",28),c(21,"Descripci\xF3n"),o(),f(22,"textarea",29),o()()),r&2){let e=d(2);m(17),$(e._categories)}}function Fe(r,t){if(r&1&&(i(0,"div",30)(1,"button",31),c(2),o()()),r&2){let e,n=d(2);m(),x("disabled",n._form.invalid),m(),b((e=n._form.get("opcLabel"))==null?null:e.value)}}function Re(r,t){if(r&1){let e=O();i(0,"form",15),p("ngSubmit",function(){g(e);let a=d();return u(a.submitForm(a._form))}),i(1,"partial-modal",16),p("eventCloseModal",function(){g(e);let a=d();return u(a.closeModal())}),h(2,De,2,1,"ng-template",null,1,C)(4,Ne,23,0,"ng-template",null,2,C)(6,Fe,3,2,"ng-template",null,3,C),o()()}if(r&2){let e=d();x("formGroup",e._form)}}function qe(r,t){r&1&&(i(0,"h2"),c(1,"Eliminar ingreso"),o())}function Le(r,t){if(r&1&&(i(0,"h4"),c(1,"\xBFEst\xE1 seguro de que desea eliminar el ingreso "),i(2,"b"),c(3),o(),c(4,"?"),o()),r&2){let e=d(2);m(3),b(e._selectedIncome.name)}}function je(r,t){if(r&1){let e=O();i(0,"partial-modalconfirmation",32),p("eventOnSuccess",function(){g(e);let a=d();return u(a.onDelete(a._selectedIncome))})("eventOnCancel",function(){g(e);let a=d();return a._modals.deleteIncome=!1,u(a._selectedIncome=null)}),h(1,qe,2,0,"ng-template",null,1,C)(3,Le,5,1,"ng-template",null,2,C),o()}}ue.setOptions(W);var ge=class r{constructor(){}_genericService=y(q);_highchartService=y(K);_indexeddbService=y(X);_modals={income:!1,deleteIncome:!1};_fb=y(me);_form=null;_incomes=[];_selectedIncome=null;_categories=[];chart=null;_categoryType=1;_options={skip:0,take:5};ngOnInit(){this._indexeddbService.getAllItems("categories","name","asc").then(t=>{t.length>0&&(this._categories=t.filter(e=>e.type===this._categoryType),this.loadTable())},t=>{console.error(t)})}ngAfterViewInit(){}ngAfterContentInit(){}ngOnDestroy(){}loadTable(){console.log("loadTable",this._options),this._indexeddbService.getListPagination("transactions",this._options.skip,this._options.take,"created","desc").then(t=>{t.length>0&&(this._incomes=t.filter(n=>n.category.type===this._categoryType).map(n=>({transactionId:n.transactionId,name:n.name,amount:n.amount,date:n.date,description:n.description,categoryId:n.categoryId,categoryName:n.category.name,categoryType:n.category.type,created:n.created})));let e=this.getChartOptions();this._incomes.length>1&&this.chart!==null?this._highchartService.updateChart(this.chart,e):this.chart=this._highchartService.buildChart("container",e)},t=>{console.error(t)})}openModal(t=null){t!==null?(this._selectedIncome=t,this._form=this._fb.group({opc:["Edit"],opcLabel:["Editar"],transactionId:[t.transactionId],name:[t.name,[_.required,_.minLength(3),_.maxLength(20)]],amount:[this._genericService.convertToCurrencyFormat(t.amount).data,[_.required,L(2)]],date:[this._genericService.transformDateToString(t.date),_.required],categoryId:[t.categoryId,_.required],description:[t.description]})):this._form=this._fb.group({opc:["Create"],opcLabel:["Crear"],name:["",[_.required,_.minLength(3),_.maxLength(20)]],amount:["",[_.required,L(2)]],date:[this._genericService.transformDateToString(this._genericService.getDateTimeNowUtc()),_.required],categoryId:[this._categories[0].categoryId,_.required],description:[""]}),this._modals.income=!0}closeModal(){this._modals.income=!1,this._form=null}submitForm(t){return A(this,null,function*(){let e=t.value,n=this._genericService.parseNumber(e.amount.replace(".",""));if(!n.confirmation){alert(n.message);return}let a=this._categories.find(l=>l.categoryId===e.categoryId&&l.type===this._categoryType);if(a===void 0){alert("No se encontr\xF3 la categor\xEDa");return}if(e.opc==="Edit"){let s=(yield this._indexeddbService.getAllItems("transactions","created","asc")).find(v=>v.transactionId===e.transactionId);if(s===void 0){alert("No se encontr\xF3 la transacci\xF3n");return}s.name=e.name,s.amount=n.data,s.date=new Date(e.date),s.description=e.description,s.categoryId=e.categoryId,s.category=a,this._indexeddbService.updateItem("transactions",s.transactionId,s).then(v=>{this._modals.income=!1,this.loadTable()},v=>{console.error(v)})}else{let l={transactionId:this._genericService.generateGuid(),name:e.name,amount:n.data,date:new Date(e.date),description:e.description,categoryId:e.categoryId,category:a,created:new Date};this._indexeddbService.addItem("transactions",l).then(s=>{this._modals.income=!1,this.loadTable()},s=>{console.error(s)})}})}modalOpenDelete(t){this._selectedIncome=t,this._modals.deleteIncome=!0}onDelete(t){this._indexeddbService.deleteItem("transactions",t.transactionId).then(e=>{this._modals.deleteIncome=!1,this.loadTable()},e=>{console.error(e)})}getTotal(){return this._incomes.reduce((t,e)=>t+e.amount,0)}getChartOptions(){let t=[],e=this._incomes.reduce((a,l)=>a+l.amount,0);for(let a=0;a<this._categories.length;a++){let l=this._categories[a],s=this._incomes.reduce((be,j)=>be+(j.categoryId===l.categoryId?j.amount:0),0),v=this._genericService.convertToCurrencyFormat(s).data,fe=e>0?s*100/e:0,Ce=this._genericService.parseNumber(fe.toFixed(2)).data;t.push({id:l.categoryId,name:`${l.name} ($${v})`,y:Ce,selected:!1,sliced:!1})}let n=t.reduce((a,l)=>a.y>l.y?a:l);return n.name=`<b style="color: var(--color-green); font-size: 0.9rem;">${n.name}</b>`,{title:{text:"Distribuci\xF3n de ingresos"},subtitle:{text:this._incomes.length>0?"":"Sin datos"},tooltip:{valueSuffix:"%"},series:this._incomes.length>0?[{type:"pie",name:"Porcentaje",showInLegend:!0,data:t}]:[]}}loadPartialTable(t){this._options=t,this.loadTable()}changePartialTable(t){this._options.take=t,this.loadTable()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=M({type:r,selectors:[["app-incomes"]],features:[B([q,I,U])],decls:16,vars:4,consts:[["caption",""],["header",""],["body",""],["footer",""],[1,"card"],[3,"eventOnLoad","eventOnChange","_values"],["id","container"],[3,"formGroup"],[1,"buttons"],["type","button",1,"btn","success",3,"click"],[1,"operations"],["type","button","title","Editar",1,"btn","success",3,"click"],[1,"pi","pi-pencil"],["type","button","title","Eliminar",1,"btn","danger",3,"click"],[1,"pi","pi-trash"],[3,"ngSubmit","formGroup"],[3,"eventCloseModal"],[1,"form"],[1,"form-group"],["for","name"],["type","text","formControlName","name","id","name","name","name","autocomplete","off","required",""],["for","amount"],["formControlName","amount","autocomplete","off"],["for","date"],["type","date","formControlName","date","id","date","name","date","autocomplete","off","required",""],["for","category"],["formControlName","categoryId","id","category","name","category","required",""],[3,"value"],["for","description"],["formControlName","description","id","description","name","description","autocomplete","off"],[1,"footer"],["type","submit",1,"btn","success",3,"disabled"],[3,"eventOnSuccess","eventOnCancel"]],template:function(e,n){if(e&1){let a=O();i(0,"section")(1,"div",4)(2,"partial-table",5),p("eventOnLoad",function(s){return g(a),u(n.loadPartialTable(s))})("eventOnChange",function(s){return g(a),u(n.changePartialTable(s))}),h(3,Te,5,0,"ng-template",null,0,C)(5,Ee,15,0,"ng-template",null,1,C)(7,we,21,12,"ng-template",null,2,C)(9,ke,2,0,"ng-template",null,3,C),o(),c(11),o(),i(12,"div",4),f(13,"div",6),o()(),h(14,Re,8,1,"form",7)(15,je,5,0,"partial-modalconfirmation")}e&2&&(m(2),x("_values",n._incomes),m(9),P(" TOTAL: $",n._genericService.convertToCurrencyFormat(n.getTotal()).data," "),m(3),w(n._modals.income&&n._form!==null?14:-1),m(),w(n._modals.deleteIncome&&n._selectedIncome!==null?15:-1))},dependencies:[S,I,se,ne,re,ce,Z,ae,ee,te,le,J,de,oe,ie,pe,_e,Y,T],styles:["partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{width:100%;display:grid}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{padding:10px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{overflow:auto;max-height:400px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{background-color:var(--color-black);border:1px solid var(--color-black-border);min-width:100%;border-spacing:0;border-collapse:collapse;position:relative}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:var(--color-black);position:sticky;top:-1px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:10px;text-align:left;word-break:break-word;overflow-wrap:break-word}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background-color:var(--color-black-weight)}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:left;word-break:break-word;overflow-wrap:break-word}section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}section[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;align-items:center}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:20px;gap:5px;border-radius:10px;background-color:var(--color-black);border:1px solid var(--color-black-border)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.6rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{font-size:1.3rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.comment[_ngcontent-%COMP%]{font-size:.8rem;color:var(--color-black-text)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .operations[_ngcontent-%COMP%]{display:flex;gap:5px;align-items:center;justify-content:center;font-size:1px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .operations[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px 10px;font-size:.8rem!important}form[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}form[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1.1rem}form[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"]})};export{ge as IncomesComponent};
