import{a as Z,b as C,c as H,d as J,e as K,f as Q,g as X,h as Y,i as ee,j as te,k as ne,l as ie,m as oe,n as ae,o as re,p as le,q as ce}from"./chunk-JISDSRV2.js";import{a as $,b as R,c as F}from"./chunk-PBSUUAEE.js";import{$a as h,Ea as N,Ja as v,Mb as I,Nb as z,Ob as A,P as G,Qa as x,Ta as T,Tb as P,Ua as E,Ub as U,V as O,Va as w,Wa as D,Xa as r,Ya as l,Za as M,ab as u,ba as g,bb as p,ca as d,e as _,gb as s,hb as f,ib as j,lb as V,mb as k,nb as L,ob as q,qb as W,rb as B,sb as b,va as m}from"./chunk-KGC6DHRS.js";var S=class o{constructor(){}_indexeddbService=O(U);_genericService=O(P);_fb=O(oe);loadTable(n,e,t){return _(this,null,function*(){var i=new F;try{yield this._indexeddbService.getAllItems("categories","created","desc").then(a=>{if(a.total>0){let c=n.search.trim().toLowerCase();e=a.items.filter(y=>y.name.toLowerCase().includes(c)).map(y=>({categoryId:y.categoryId,name:y.name,type:y.type,created:this._genericService.addMinutesToDate(y.created,t.minutesOfDifferenceTimeZone),isDefault:y.isDefault})),n.total=e.length}i.data={partialTableOptions:n,categories:e},i.confirmation=!0,i.message="Tabla cargada correctamente"},a=>{console.error(a)})}catch(a){console.error(a),i.message=a.message,i.exception=a.toString()}return i})}modalOpen(n,e=null){var t=new F;try{e!==null?t.data=this._fb.group({opc:["Edit"],opcLabel:["Editar"],categoryId:[e.categoryId,[C.required]],name:[e.name,[C.required,C.minLength(3),C.maxLength(20)]],type:[e.type,[C.required]]}):t.data=this._fb.group({opc:["Create"],opcLabel:["Crear"],name:["",[C.required,C.minLength(3),C.maxLength(20)]],type:[1,[C.required]]}),t.confirmation=!0,t.message="Modal abierto correctamente"}catch(i){console.error(i),t.message=i.message,t.exception=i.toString()}return t}createOrUpdate(n){return _(this,null,function*(){var e=new R;try{let t=n.value,i=this._genericService.parseNumber(t.type);if(!i.confirmation)return e.message=i.message,e.exception=i.exception,e;if(t.opc==="Edit")yield this._indexeddbService.getItem("categories",t.categoryId).then(a=>_(this,null,function*(){a.name=t.name,a.type=i.data,yield this._indexeddbService.updateItem("categories",a.categoryId,a).then(c=>{e.confirmation=!0,e.message="Categoria actualizada correctamente"},c=>{console.error(c),e.message=c.message,e.exception=c.toString()})}),a=>{console.error(a),e.message=a.message,e.exception=a.toString()});else{let a={categoryId:this._genericService.generateGuid(),name:t.name,type:i.data,created:this._genericService.getDateTimeNowUtc(),isDefault:!1};yield this._indexeddbService.addItem("categories",a).then(c=>{e.confirmation=!0,e.message="Categoria creada correctamente"},c=>{console.error(c),e.message=c.message,e.exception=c.toString()})}}catch(t){console.error(t),e.message=t.message,e.exception=t.toString()}return e})}delete(n){return _(this,null,function*(){var e=new R;try{yield this._indexeddbService.deleteItem("categories",n).then(t=>{this._indexeddbService.getAllItems("transactions","created","desc").then(i=>{i.total>0&&i.items.filter(a=>a.categoryId===n).forEach(a=>_(this,null,function*(){yield this._indexeddbService.deleteItem("transactions",a.transactionId)}))},i=>{console.error(i),e.message=i.message,e.exception=i.toString()}),e.confirmation=!0,e.message="Categoria eliminada correctamente"},t=>{console.error(t),e.message=t.message,e.exception=t.toString()})}catch(t){console.error(t),e.message=t.message,e.exception=t.toString()}return e})}static \u0275fac=function(e){return new(e||o)};static \u0275prov=G({token:o,factory:o.\u0275fac,providedIn:"root"})};function pe(o,n){if(o&1&&(r(0,"option",9),s(1),l()),o&2){let e=n.$implicit;x("value",e.value),m(),f(e.label)}}function ge(o,n){if(o&1&&(r(0,"option",9),s(1),l()),o&2){let e=n.$implicit;x("value",e.value),m(),f(e.label)}}function de(o,n){if(o&1){let e=h();r(0,"div",14)(1,"h2"),s(2,"Categorias"),l(),r(3,"button",15),u("click",function(){g(e);let i=p();return d(i.onOpenModal())}),s(4,"Agregar categoria"),l(),r(5,"input",16),u("input",function(i){g(e);let a=p();return d(a.onSearch(i))}),l()()}}function _e(o,n){o&1&&(r(0,"tr")(1,"th"),s(2,"Tipo"),l(),r(3,"th"),s(4,"Nombre"),l(),r(5,"th"),s(6,"Creaci\xF3n"),l(),r(7,"th"),s(8,"OPC"),l()())}function ue(o,n){if(o&1){let e=h();r(0,"div",17)(1,"button",18),u("click",function(){g(e);let i=p().$implicit,a=p();return d(a.onOpenModal(i))}),M(2,"i",19),l(),r(3,"button",20),u("click",function(){g(e);let i=p().$implicit,a=p();return d(a.onModalOpenDelete(i))}),M(4,"i",21),l()()}}function Ce(o,n){if(o&1&&(r(0,"tr")(1,"td"),s(2),l(),r(3,"td"),s(4),l(),r(5,"td"),s(6),W(7,"date"),l(),r(8,"td"),v(9,ue,5,0,"div",17),l()()),o&2){let e=n.$implicit;m(2),f(e.type===1?"Ingreso":"Gasto"),m(2),f(e.name),m(2),f(B(7,4,e.created,"dd/MM/yyyy hh:mm a")),m(3),T(e.isDefault?-1:9)}}function fe(o,n){if(o&1&&(r(0,"h2"),s(1),l()),o&2){let e,t=p(2);m(),j("",(e=t._form.get("opcLabel"))==null?null:e.value," categoria")}}function be(o,n){if(o&1&&(r(0,"option",9),s(1),l()),o&2){let e=n.$implicit;x("value",e.value),m(),f(e.label)}}function ye(o,n){if(o&1&&(r(0,"div",5)(1,"div",6)(2,"label",24),s(3,"Nombre"),l(),M(4,"input",25),l(),r(5,"div",6)(6,"label",26),s(7,"Tipo"),l(),r(8,"select",27),w(9,be,2,2,"option",9,E),l()()()),o&2){let e=p(2);m(9),D(e._categoryTypes)}}function Oe(o,n){if(o&1&&(r(0,"div",28)(1,"button",29),s(2),l()()),o&2){let e,t=p(2);m(),x("disabled",t._form.invalid),m(),f((e=t._form.get("opcLabel"))==null?null:e.value)}}function xe(o,n){if(o&1){let e=h();r(0,"form",22),u("ngSubmit",function(){g(e);let i=p();return d(i.onSubmitForm(i._form))}),r(1,"partial-modal",23),u("eventCloseModal",function(){g(e);let i=p();return d(i.onCloseModal())}),v(2,fe,2,1,"ng-template",null,1,b)(4,ye,11,0,"ng-template",null,2,b)(6,Oe,3,2,"ng-template",null,3,b),l()()}if(o&2){let e=p();x("formGroup",e._form)}}function ve(o,n){o&1&&(r(0,"h2"),s(1,"Eliminar ingreso"),l())}function he(o,n){if(o&1&&(r(0,"h4"),s(1,"\xBFEst\xE1 seguro de que desea eliminar el ingreso "),r(2,"b"),s(3),l(),s(4,"?"),l()),o&2){let e=p(2);m(3),f(e._selectedCategory.name)}}function Me(o,n){if(o&1){let e=h();r(0,"partial-modalconfirmation",30),u("eventOnSuccess",function(){g(e);let i=p();return d(i.onDelete(i._selectedCategory))})("eventOnCancel",function(){g(e);let i=p();return i._modals.deleteCategory=!1,d(i._selectedCategory=null)}),v(1,ve,2,0,"ng-template",null,1,b)(3,he,5,1,"ng-template",null,2,b),l()}}var se=class o{constructor(){}_genericService=O(P);_configurationService=O(S);_categories=[];_selectedCategory=null;_selectedCurrency="$";_currencies=[{value:"$",label:"$ USD"},{value:"\u20AC",label:"\u20AC EUR"},{value:"S/.",label:"S/. PEN"}];_selectedLanguage="es";_languages=[{value:"en",label:"English"},{value:"es",label:"Espa\xF1ol"}];_partialTableOptions={search:"",skip:0,take:5,total:0};_form=null;_modals={category:!1,deleteCategory:!1};_categoryTypes=[{value:1,label:"Ingreso"},{value:2,label:"Gasto"}];_localStorage={currency:this._genericService.getLocalStorage("currency")||"$",language:this._genericService.getLocalStorage("language")||"es",minutesOfDifferenceTimeZone:-300};ngOnInit(){this._selectedCurrency=this._genericService.getLocalStorage("currency")||"$",this.loadTable()}ngAfterViewInit(){}ngAfterContentInit(){}ngOnDestroy(){}loadTable(){return _(this,null,function*(){let n=yield this._configurationService.loadTable(this._partialTableOptions,this._categories,this._localStorage);n.confirmation&&(this._partialTableOptions=n.data.partialTableOptions,this._categories=n.data.categories)})}onOpenModal(n=null){var e=this._configurationService.modalOpen(this._categories,n);if(!e.confirmation){alert(e.message);return}this._form=e.data,this._selectedCategory=n,this._modals.category=!0}onCloseModal(){this._modals.category=!1}onSubmitForm(n){return _(this,null,function*(){var e=yield this._configurationService.createOrUpdate(n);if(!e.confirmation){alert(e.message);return}this._modals.category=!1,this.loadTable()})}onModalOpenDelete(n){this._selectedCategory=n,this._modals.deleteCategory=!0}onDelete(n){return _(this,null,function*(){let e=yield this._configurationService.delete(n.categoryId);if(!e.confirmation){alert(e.message);return}this._modals.deleteCategory=!1,this.loadTable()})}loadPartialTable(n){this._partialTableOptions=n,this.loadTable()}changePartialTable(n){this._partialTableOptions=n,this.loadTable()}onSearch(n){this._partialTableOptions.search=n.target.value,this.loadTable()}onChangeCurrency(n){this._genericService.setLocalStorage("currency",n.target.value)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=N({type:o,selectors:[["app-configuration"]],features:[q([S,P,I,z])],decls:27,vars:6,consts:[["caption",""],["header",""],["body",""],["footer",""],[1,"card"],[1,"form"],[1,"form-group"],["for","language"],["id","language","name","language","required","",3,"ngModelChange","ngModel"],[3,"value"],["for","currency"],["id","currency","name","currency","required","",3,"ngModelChange","change","ngModel"],[3,"eventOnLoad","eventOnChange","_values","_options"],[3,"formGroup"],[1,"caption"],["type","button",1,"btn","success",3,"click"],["type","text","placeholder","Busqueda rapida...",3,"input"],[1,"operations"],["type","button","title","Editar",1,"btn","primary",3,"click"],[1,"pi","pi-pen-to-square"],["type","button","title","Eliminar",1,"btn","danger",3,"click"],[1,"pi","pi-trash"],[3,"ngSubmit","formGroup"],[3,"eventCloseModal"],["for","name"],["type","text","formControlName","name","id","name","name","name","autocomplete","off","required",""],["for","type"],["formControlName","type","id","type","name","type","required",""],[1,"footer"],["type","submit",1,"btn","success",3,"disabled"],[3,"eventOnSuccess","eventOnCancel"]],template:function(e,t){if(e&1){let i=h();r(0,"section")(1,"div",4)(2,"h2"),s(3,"Configuraci\xF3n"),l(),r(4,"div",5)(5,"div",6)(6,"label",7),s(7,"Idioma"),l(),r(8,"select",8),L("ngModelChange",function(c){return g(i),k(t._selectedLanguage,c)||(t._selectedLanguage=c),d(c)}),w(9,pe,2,2,"option",9,E),l()(),r(11,"div",6)(12,"label",10),s(13,"Divisa"),l(),r(14,"select",11),L("ngModelChange",function(c){return g(i),k(t._selectedCurrency,c)||(t._selectedCurrency=c),d(c)}),u("change",function(c){return g(i),d(t.onChangeCurrency(c))}),w(15,ge,2,2,"option",9,E),l()()(),M(17,"hr"),r(18,"partial-table",12),u("eventOnLoad",function(c){return g(i),d(t.loadPartialTable(c))})("eventOnChange",function(c){return g(i),d(t.changePartialTable(c))}),v(19,de,6,0,"ng-template",null,0,b)(21,_e,9,0,"ng-template",null,1,b)(23,Ce,10,7,"ng-template",null,2,b),l()()(),v(25,xe,8,1,"form",13)(26,Me,5,0,"partial-modalconfirmation")}e&2&&(m(8),V("ngModel",t._selectedLanguage),m(),D(t._languages),m(5),V("ngModel",t._selectedCurrency),m(),D(t._currencies),m(3),x("_values",t._categories)("_options",t._partialTableOptions),m(7),T(t._modals.category&&t._form!==null?25:-1),m(),T(t._modals.deleteCategory&&t._selectedCategory!==null?26:-1))},dependencies:[A,I,ae,Q,te,ne,Z,ee,H,J,ie,K,re,X,Y,le,$,ce],styles:["partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{width:100%;display:grid;gap:10px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{overflow:auto;max-height:400px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]{background-color:var(--color-black);border:1px solid var(--color-black-border);min-width:100%;border-spacing:0;border-collapse:collapse;position:relative}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:var(--color-black);position:sticky;top:-1px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:10px;text-align:left;word-break:break-word;overflow-wrap:break-word}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background-color:var(--color-black-weight)}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:left;word-break:break-word;overflow-wrap:break-word}section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}section[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr auto 1fr;align-items:center;gap:10px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:20px;gap:20px;border-radius:10px;background-color:var(--color-black);border:1px solid var(--color-black-border)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.6rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1.1rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{font-size:1.3rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.comment[_ngcontent-%COMP%]{font-size:.8rem;color:var(--color-black-text)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .operations[_ngcontent-%COMP%]{display:flex;gap:5px;align-items:center;justify-content:center;font-size:1px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .operations[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px 10px;font-size:.8rem!important}.form[_ngcontent-%COMP%], .form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1.1rem}.footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"]})};export{se as ConfigurationComponent};
