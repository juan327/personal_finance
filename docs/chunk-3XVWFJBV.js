import{a as q,b as te,c as E,d as J}from"./chunk-G6VEXFTW.js";import{a as K,c as I}from"./chunk-7A5JR2EX.js";import{$a as B,Ea as W,Ja as V,Nb as D,Ob as U,P as j,Pb as Y,Qa as z,Sa as F,Ub as S,V as _,Vb as Q,Xa as i,Ya as n,Za as A,ab as $,ba as w,bb as L,ca as H,d as ee,e as T,gb as o,hb as f,ib as v,jb as M,kb as k,ob as G,qb as C,rb as x,sb as b,va as m}from"./chunk-JE4FXYSB.js";var Z=ee(te());var P=class l{constructor(){}_indexeddbService=_(Q);_highchartService=_(E);_genericService=_(S);loadTable(a,t,e,s,g){return T(this,null,function*(){var c=new I;try{yield this._indexeddbService.getAllItems("transactions","created","desc").then(p=>{p.total>0&&(a.total=p.total,t=p.items.map(r=>({transactionId:r.transactionId,name:r.name,amount:r.amount,amountString:`${s.currency} ${this._genericService.convertToCurrencyFormat(r.amount).data}`,date:r.date,description:r.description,categoryId:r.categoryId,categoryName:r.category.name,categoryType:r.category.type,created:r.created})));let d=this.getChartOptions(t,s);d.confirmation?t.length>1&&g!==null?this._highchartService.updateChart(g,d.data):g=this._highchartService.buildChart("container",d.data):(c.message=d.message,c.exception=d.exception),c.data={partialTableOptions:a,transactions:t,categories:e,chart:g},c.confirmation=!0,c.message="Tabla cargada correctamente"},p=>{console.error(p)})}catch(p){console.error(p),c.message=p.message,c.exception=p.toString()}return c})}updateResults(a,t){var e=new I;try{let s=t.filter(u=>u.categoryType===1),g=t.filter(u=>u.categoryType===2),c=s.reduce((u,y)=>u+y.amount,0),p=g.reduce((u,y)=>u+y.amount,0),d=this._genericService.convertToCurrencyFormat(c);if(!d.confirmation)return alert(d.message),e;let r=this._genericService.convertToCurrencyFormat(p);if(!r.confirmation)return alert(r.message),e;let O=this._genericService.convertToCurrencyFormat(c-p);if(!O.confirmation)return alert(O.message),e;e.data={incomes:s,expenses:g,totalIncomes:d.data,totalExpenses:r.data,total:O.data,totalInt:c-p},e.confirmation=!0,e.message="Resultados cargados correctamente"}catch(s){console.error(s),e.message=s.message,e.exception=s.toString()}return e}getChartOptions(a,t){var e=new I;try{let s=[],g=[],c=this._genericService.getMonthsFromYear(2025);for(let d=0;d<c.length;d++){let r=c[d],O=a.reduce((R,h)=>R+(h.categoryType===1&&h.date>=r.dateStart&&h.date<=r.dateEnd?h.amount:0),0),u=a.reduce((R,h)=>R+(h.categoryType===2&&h.date>=r.dateStart&&h.date<=r.dateEnd?h.amount:0),0),y=this._genericService.convertToNumberDecimal(O);if(!y.confirmation)continue;let N=this._genericService.convertToNumberDecimal(u);N.confirmation&&(s.push({name:r.name,y:y.data}),g.push({name:r.name,y:N.data}))}let p=[{name:"Ingresos",data:s,color:"var(--color-green)"},{name:"Gastos",data:g,color:"var(--color-red)"}];e.data={chart:{type:"column"},title:{text:"Rendimiento del a\xF1o"},xAxis:{categories:c.map(d=>d.name),crosshair:!0,accessibility:{description:"Countries"}},yAxis:{min:0,title:{text:"A\xD1O 2025"}},plotOptions:{column:{pointPadding:.2,borderWidth:0}},tooltip:{valuePrefix:t.currency+" "},series:p},e.confirmation=!0,e.message="Opciones del gr\xE1fico cargadas correctamente"}catch(s){console.error(s),e.message=s.message,e.exception=s.toString()}return e}static \u0275fac=function(t){return new(t||l)};static \u0275prov=j({token:l,factory:l.\u0275fac,providedIn:"root"})};function ae(l,a){l&1&&(i(0,"h2"),o(1,"Ultimos movimientos"),n())}function oe(l,a){l&1&&(i(0,"tr")(1,"th"),o(2,"Categor\xEDa"),n(),i(3,"th"),o(4,"Nombre"),n(),i(5,"th"),o(6,"Monto"),n(),i(7,"th"),o(8,"Fecha"),n(),i(9,"th"),o(10,"Creaci\xF3n"),n()())}function ie(l,a){if(l&1&&(i(0,"tr")(1,"td"),o(2),n(),i(3,"td"),o(4),n(),i(5,"td"),o(6),n(),i(7,"td"),o(8),C(9,"date"),n(),i(10,"td"),o(11),C(12,"date"),n()()),l&2){let t=a.$implicit,e=L();F(t.categoryType===1?"income":"expense"),m(2),f(t.categoryName),m(2),f(t.name),m(2),k(" ",e._localStorage.currency," ",t.categoryType===1?"":"-","",e._genericService.convertToCurrencyFormat(t.amount).data," "),m(2),f(x(9,9,t.date,"dd/MM/yyyy hh:mm a")),m(3),f(x(12,12,t.created,"dd/MM/yyyy hh:mm a"))}}function re(l,a){if(l&1&&(i(0,"ul")(1,"li")(2,"strong"),o(3,"Categor\xEDa:"),n(),o(4),n(),i(5,"li")(6,"strong"),o(7,"Nombre:"),n(),o(8),n(),i(9,"li")(10,"strong"),o(11,"Monto:"),n(),o(12),n(),i(13,"li")(14,"strong"),o(15,"Fecha:"),n(),o(16),C(17,"date"),n(),i(18,"li")(19,"strong"),o(20,"Creaci\xF3n:"),n(),o(21),C(22,"date"),n()()),l&2){let t=a.$implicit,e=L();m(4),v(" ",t.categoryName,""),m(4),v(" ",t.name,""),m(4),k(" ",e._localStorage.currency," ",t.categoryType===1?"":"-","",e._genericService.convertToCurrencyFormat(t.amount).data,""),m(4),v(" ",x(17,7,t.date,"dd/MM/yyyy hh:mm a"),""),m(5),v(" ",x(22,10,t.created,"dd/MM/yyyy hh:mm a"),"")}}Z.setOptions(J);var X=class l{constructor(){}_genericService=_(S);_highchartService=_(E);_homeService=_(P);_transactions=[];_categories=[];_results={incomes:[],expenses:[],totalIncomes:"0",totalExpenses:"0",total:"0",totalInt:0};_partialTableOptions={search:"",skip:0,take:5,total:0};_chart=null;_localStorage={currency:this._genericService.getLocalStorage("currency")||"$",language:this._genericService.getLocalStorage("language")||"es"};ngOnInit(){this.loadTable()}ngAfterViewInit(){}ngOnDestroy(){}loadTable(){return T(this,null,function*(){let a=yield this._homeService.loadTable(this._partialTableOptions,this._transactions,this._categories,this._localStorage,this._chart);a.confirmation&&(this._partialTableOptions=a.data.partialTableOptions,this._transactions=a.data.transactions,this._categories=a.data.categories,this._chart=a.data.chart,this.updateResults())})}updateResults(){return T(this,null,function*(){let a=yield this._homeService.updateResults(this._results,this._transactions);a.confirmation&&(this._results=a.data)})}loadPartialTable(a){this._partialTableOptions=a,this.loadTable()}changePartialTable(a){this._partialTableOptions=a,this.loadTable()}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=W({type:l,selectors:[["app-home"]],features:[G([P,D,U,S])],decls:29,vars:9,consts:[["caption",""],["header",""],["body",""],["bodyMobile",""],[1,"widgets"],[1,"card","total"],[1,"title"],[1,"balance"],[1,"card","total-incomes"],[1,"balance","income"],[1,"card","total-expenses"],[1,"balance","expense"],[1,"card"],["id","container"],[3,"eventOnLoad","eventOnChange","_values"]],template:function(t,e){if(t&1){let s=B();i(0,"section")(1,"div",4)(2,"div",5)(3,"span",6),o(4,"Balance total"),n(),i(5,"h3",7),o(6),n()(),i(7,"div",8)(8,"span",6),o(9,"Ingresos totales"),n(),i(10,"h3",9),o(11),n()(),i(12,"div",10)(13,"span",6),o(14,"Gastos totales"),n(),i(15,"h3",11),o(16),n()()(),i(17,"div",12),A(18,"div",13),n(),i(19,"div",12)(20,"partial-table",14),$("eventOnLoad",function(c){return w(s),H(e.loadPartialTable(c))})("eventOnChange",function(c){return w(s),H(e.changePartialTable(c))}),V(21,ae,2,0,"ng-template",null,0,b)(23,oe,11,0,"ng-template",null,1,b)(25,ie,13,15,"ng-template",null,2,b)(27,re,23,13,"ng-template",null,3,b),n()()()}t&2&&(m(5),F(e._results.totalInt>=0?"income":"expense"),m(),M(" ",e._localStorage.currency," ",e._results.total," "),m(5),M(" ",e._localStorage.currency," ",e._results.totalIncomes," "),m(5),M(" ",e._localStorage.currency," ",e._results.totalExpenses," "),m(4),z("_values",e._transactions))},dependencies:[Y,D,q,K],styles:["section[_ngcontent-%COMP%]{container-type:inline-size;display:flex;flex-direction:column;gap:20px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:20px;gap:5px;border-radius:10px;background-color:var(--color-black);border:1px solid var(--color-black-border)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   partial-table[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center}section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.6rem}section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem}section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{font-size:1.3rem}section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.comment[_ngcontent-%COMP%]{font-size:.8rem;color:var(--color-black-text)}section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .balance.income[_ngcontent-%COMP%]{color:var(--color-green)}section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .balance.expense[_ngcontent-%COMP%]{color:var(--color-red)}@container (width <= 700px){section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:last-child{grid-column:span 2}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{padding:10px!important}}@container (width <= 500px){section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]{grid-template-columns:1fr}section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:last-child{grid-column:initial}}tr.income[_ngcontent-%COMP%]{background-color:#86efac33!important}tr.income[_ngcontent-%COMP%]:nth-child(odd){background-color:#47d47a33!important}tr.expense[_ngcontent-%COMP%]{background-color:#f663!important}tr.expense[_ngcontent-%COMP%]:nth-child(odd){background-color:#f003!important}"]})};export{X as HomeComponent};
