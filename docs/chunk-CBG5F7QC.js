import{a as ie,b as E}from"./chunk-LDHYV47A.js";import{a as A,b as pe,c as G,d as $}from"./chunk-WBIR7ZZU.js";import{b as j,c as d,d as B,e as U,g as J,h as K,i as Q,j as W,k as X,l as Y,m as Z,n as ee,o as te,p as ne,q as oe,r as re}from"./chunk-F4QZEJFO.js";import{a as H}from"./chunk-7QTDYJDQ.js";import{$a as b,Ea as V,Ja as y,Mb as M,Nb as q,Ob as R,Qa as v,Ta as I,Tb as S,Ua as k,Ub as z,V as x,Va as N,Wa as F,Xa as r,Ya as i,Za as h,ab as u,ba as p,bb as s,ca as _,d as de,e as D,gb as c,hb as C,ib as O,ob as L,qb as P,rb as T,sb as f,va as m}from"./chunk-XMB6CGJJ.js";var le=de(pe());function _e(a,t){if(a&1){let e=b();r(0,"div",8)(1,"h2"),c(2,"Historial"),i(),r(3,"button",9),u("click",function(){p(e);let n=s();return _(n.openModal())}),c(4,"Agregar ingreso"),i(),r(5,"input",10),u("input",function(n){p(e);let l=s();return _(l.search(n))}),i()()}}function ge(a,t){a&1&&(r(0,"tr")(1,"th"),c(2,"Categor\xEDa"),i(),r(3,"th"),c(4,"Nombre"),i(),r(5,"th"),c(6,"Monto"),i(),r(7,"th"),c(8,"Fecha"),i(),r(9,"th"),c(10,"Descripci\xF3n"),i(),r(11,"th"),c(12,"Creaci\xF3n"),i(),r(13,"th"),c(14,"OPC"),i()())}function ue(a,t){if(a&1){let e=b();r(0,"tr")(1,"td"),c(2),i(),r(3,"td"),c(4),i(),r(5,"td"),c(6),i(),r(7,"td"),c(8),P(9,"date"),i(),r(10,"td"),c(11),i(),r(12,"td"),c(13),P(14,"date"),i(),r(15,"td")(16,"div",11)(17,"button",12),u("click",function(){let n=p(e).$implicit,l=s();return _(l.openModal(n))}),h(18,"i",13),i(),r(19,"button",14),u("click",function(){let n=p(e).$implicit,l=s();return _(l.modalOpenDelete(n))}),h(20,"i",15),i()()()()}if(a&2){let e=t.$implicit,o=s();m(2),C(e.categoryName),m(2),C(e.name),m(2),O("$",o._genericService.convertToCurrencyFormat(e.amount).data,""),m(2),C(T(9,6,e.date,"dd/MM/yyyy hh:mm a")),m(3),C(e.description),m(2),C(T(14,9,e.created,"dd/MM/yyyy hh:mm a"))}}function fe(a,t){if(a&1){let e=b();r(0,"button",9),u("click",function(){p(e);let n=s();return _(n.openModal())}),c(1,"Agregar ingreso"),i()}}function Ce(a,t){if(a&1&&(r(0,"h2"),c(1),i()),a&2){let e,o=s(2);m(),O("",(e=o._form.get("opcLabel"))==null?null:e.value," ingreso")}}function he(a,t){if(a&1&&(r(0,"option",28),c(1),i()),a&2){let e=t.$implicit;v("value",e.categoryId),m(),C(e.name)}}function be(a,t){if(a&1&&(r(0,"div",18)(1,"div",19)(2,"label",20),c(3,"Nombre"),i(),h(4,"input",21),i(),r(5,"div",19)(6,"label",22),c(7,"Cantidad"),i(),h(8,"partial-inputnumber",23),i(),r(9,"div",19)(10,"label",24),c(11,"Fecha"),i(),h(12,"input",25),i(),r(13,"div",19)(14,"label",26),c(15,"Categor\xEDa"),i(),r(16,"select",27),N(17,he,2,2,"option",28,k),i()(),r(19,"div",19)(20,"label",29),c(21,"Descripci\xF3n"),i(),h(22,"textarea",30),i()()),a&2){let e=s(2);m(17),F(e._categories)}}function xe(a,t){if(a&1&&(r(0,"div",31)(1,"button",32),c(2),i()()),a&2){let e,o=s(2);m(),v("disabled",o._form.invalid),m(),C((e=o._form.get("opcLabel"))==null?null:e.value)}}function ye(a,t){if(a&1){let e=b();r(0,"form",16),u("ngSubmit",function(){p(e);let n=s();return _(n.submitForm(n._form))}),r(1,"partial-modal",17),u("eventCloseModal",function(){p(e);let n=s();return _(n.closeModal())}),y(2,Ce,2,1,"ng-template",null,1,f)(4,be,23,0,"ng-template",null,2,f)(6,xe,3,2,"ng-template",null,3,f),i()()}if(a&2){let e=s();v("formGroup",e._form)}}function ve(a,t){a&1&&(r(0,"h2"),c(1,"Eliminar ingreso"),i())}function Oe(a,t){if(a&1&&(r(0,"h4"),c(1,"\xBFEst\xE1 seguro de que desea eliminar el ingreso "),r(2,"b"),c(3),i(),c(4,"?"),i()),a&2){let e=s(2);m(3),C(e._selectedIncome.name)}}function Me(a,t){if(a&1){let e=b();r(0,"partial-modalconfirmation",33),u("eventOnSuccess",function(){p(e);let n=s();return _(n.onDelete(n._selectedIncome))})("eventOnCancel",function(){p(e);let n=s();return n._modals.deleteIncome=!1,_(n._selectedIncome=null)}),y(1,ve,2,0,"ng-template",null,1,f)(3,Oe,5,1,"ng-template",null,2,f),i()}}le.setOptions($);var ae=class a{constructor(){}_genericService=x(S);_highchartService=x(G);_indexeddbService=x(z);_modals={income:!1,deleteIncome:!1};_fb=x(ee);_form=null;_incomes=[];_selectedIncome=null;_categories=[];chart=null;_categoryType=1;_options={search:"",skip:0,take:5,total:0};ngOnInit(){this._indexeddbService.getAllItems("categories","name","desc").then(t=>{t.total>0&&(this._categories=t.items.filter(e=>e.type===this._categoryType),this.loadTable())},t=>{console.error(t)})}ngAfterViewInit(){}ngAfterContentInit(){}ngOnDestroy(){}loadTable(){this._indexeddbService.getAllItems("transactions","created","desc").then(t=>{if(t.total>0){let o=this._options.search.trim().toLowerCase();this._incomes=t.items.filter(n=>n.category.type===this._categoryType&&(n.name.toLowerCase().includes(o)||n.description.toLowerCase().includes(o)||n.category.name.toLowerCase().includes(o))).map(n=>({transactionId:n.transactionId,name:n.name,amount:n.amount,date:n.date,description:n.description,categoryId:n.categoryId,categoryName:n.category.name,categoryType:n.category.type,created:n.created})),this._options.total=this._incomes.length}let e=this.getChartOptions();this._incomes.length>1&&this.chart!==null?this._highchartService.updateChart(this.chart,e):this.chart=this._highchartService.buildChart("container",e)},t=>{console.error(t)})}openModal(t=null){t!==null?(this._selectedIncome=t,this._form=this._fb.group({opc:["Edit"],opcLabel:["Editar"],transactionId:[t.transactionId,[d.required]],name:[t.name,[d.required,d.minLength(3),d.maxLength(20)]],amount:[this._genericService.convertToNumberDecimal(t.amount).data.toString(),[d.required,E(2)]],date:[this._genericService.transformDateToString(t.date),[d.required]],categoryId:[t.categoryId,[d.required]],description:[t.description]})):this._form=this._fb.group({opc:["Create"],opcLabel:["Crear"],name:["",[d.required,d.minLength(3),d.maxLength(20)]],amount:["",[d.required,E(2)]],date:[this._genericService.transformDateToString(this._genericService.getDateTimeNowUtc()),[d.required]],categoryId:[this._categories[0].categoryId,[d.required]],description:[""]}),console.log(this._form.value),this._modals.income=!0}closeModal(){this._modals.income=!1,this._form=null}submitForm(t){return D(this,null,function*(){let e=t.value,o=this._genericService.parseNumber(e.amount.replace(".",""));if(!o.confirmation){alert(o.message);return}let n=this._categories.find(l=>l.categoryId===e.categoryId&&l.type===this._categoryType);if(n===void 0){alert("No se encontr\xF3 la categor\xEDa");return}if(e.opc==="Edit")this._indexeddbService.getItem("transactions",e.transactionId).then(l=>{l.name=e.name,l.amount=o.data,l.date=new Date(e.date),l.description=e.description,l.categoryId=e.categoryId,l.category=n,this._indexeddbService.updateItem("transactions",l.transactionId,l).then(g=>{this._modals.income=!1,this.loadTable()},g=>{console.error(g)})},l=>{console.error(l)});else{let l={transactionId:this._genericService.generateGuid(),name:e.name,amount:o.data,date:new Date(e.date),description:e.description,categoryId:e.categoryId,category:n,created:new Date};this._indexeddbService.addItem("transactions",l).then(g=>{this._modals.income=!1,this.loadTable()},g=>{console.error(g)})}})}modalOpenDelete(t){this._selectedIncome=t,this._modals.deleteIncome=!0}onDelete(t){this._indexeddbService.deleteItem("transactions",t.transactionId).then(e=>{this._modals.deleteIncome=!1,this.loadTable()},e=>{console.error(e)})}getTotal(){return this._incomes.reduce((t,e)=>t+e.amount,0)}getChartOptions(){let t=[],e=this._incomes.reduce((o,n)=>o+n.amount,0);for(let o=0;o<this._categories.length;o++){let n=this._categories[o],l=this._incomes.reduce((se,w)=>se+(w.categoryId===n.categoryId?w.amount:0),0),g=this._genericService.convertToCurrencyFormat(l).data,ce=e>0?l*100/e:0,me=this._genericService.parseNumber(ce.toFixed(2)).data;t.push({id:n.categoryId,name:`${n.name} ($${g})`,y:me,selected:!1,sliced:!1})}if(t.length>0){let o=t.reduce((n,l)=>n.y>l.y?n:l);o.name=`<b style="color: var(--color-green); font-size: 0.9rem;">${o.name}</b>`}return{title:{text:"Distribuci\xF3n de ingresos"},subtitle:{text:this._incomes.length>0?"":"Sin datos"},tooltip:{valueSuffix:"%"},series:this._incomes.length>0?[{type:"pie",name:"Porcentaje",showInLegend:!0,data:t}]:[]}}loadPartialTable(t){this._options=t,this.loadTable()}changePartialTable(t){this._options=t,this.loadTable()}search(t){this._options.search=t.target.value,this.loadTable()}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=V({type:a,selectors:[["app-incomes"]],features:[L([S,M,q])],decls:16,vars:5,consts:[["caption",""],["header",""],["body",""],["footer",""],[1,"card"],[3,"eventOnLoad","eventOnChange","_values","_options"],["id","container"],[3,"formGroup"],[1,"caption"],["type","button",1,"btn","success",3,"click"],["type","text","placeholder","Busqueda rapida...",3,"input"],[1,"operations"],["type","button","title","Editar",1,"btn","primary",3,"click"],[1,"pi","pi-pen-to-square"],["type","button","title","Eliminar",1,"btn","danger",3,"click"],[1,"pi","pi-trash"],[3,"ngSubmit","formGroup"],[3,"eventCloseModal"],[1,"form"],[1,"form-group"],["for","name"],["type","text","formControlName","name","id","name","name","name","autocomplete","off","required",""],["for","amount"],["formControlName","amount","autocomplete","off"],["for","date"],["type","date","formControlName","date","id","date","name","date","autocomplete","off","required",""],["for","category"],["formControlName","categoryId","id","category","name","category","required",""],[3,"value"],["for","description"],["formControlName","description","id","description","name","description","autocomplete","off"],[1,"footer"],["type","submit",1,"btn","success",3,"disabled"],[3,"eventOnSuccess","eventOnCancel"]],template:function(e,o){if(e&1){let n=b();r(0,"section")(1,"div",4)(2,"partial-table",5),u("eventOnLoad",function(g){return p(n),_(o.loadPartialTable(g))})("eventOnChange",function(g){return p(n),_(o.changePartialTable(g))}),y(3,_e,6,0,"ng-template",null,0,f)(5,ge,15,0,"ng-template",null,1,f)(7,ue,21,12,"ng-template",null,2,f)(9,fe,2,0,"ng-template",null,3,f),i(),c(11),i(),r(12,"div",4),h(13,"div",6),i()(),y(14,ye,8,1,"form",7)(15,Me,5,0,"partial-modalconfirmation")}e&2&&(m(2),v("_values",o._incomes)("_options",o._options),m(9),O(" TOTAL: $",o._genericService.convertToCurrencyFormat(o.getTotal()).data," "),m(3),I(o._modals.income&&o._form!==null?14:-1),m(),I(o._modals.deleteIncome&&o._selectedIncome!==null?15:-1))},dependencies:[R,M,te,J,X,Y,j,W,B,U,Z,A,ne,K,Q,oe,ie,H,re],styles:["partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{width:100%;display:grid;gap:10px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{overflow:auto;max-height:400px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{background-color:var(--color-black);border:1px solid var(--color-black-border);min-width:100%;border-spacing:0;border-collapse:collapse;position:relative}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:var(--color-black);position:sticky;top:-1px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:10px;text-align:left;word-break:break-word;overflow-wrap:break-word}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background-color:var(--color-black-weight)}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:left;word-break:break-word;overflow-wrap:break-word}section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}section[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{display:grid;grid-template-columns:2fr auto 1fr;align-items:center;gap:10px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:20px;gap:5px;border-radius:10px;background-color:var(--color-black);border:1px solid var(--color-black-border)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.6rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{font-size:1.3rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.comment[_ngcontent-%COMP%]{font-size:.8rem;color:var(--color-black-text)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .operations[_ngcontent-%COMP%]{display:flex;gap:5px;align-items:center;justify-content:center;font-size:1px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .operations[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px 10px;font-size:.8rem!important}form[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}form[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1.1rem}form[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"]})};export{ae as IncomesComponent};
