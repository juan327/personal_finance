import{a as se,b as j,c as pe,d as de}from"./chunk-XYF67UR7.js";import{a as U,b as be,c as J,d as K}from"./chunk-G6VEXFTW.js";import{a as Y,b as y,c as Z,d as ee,f as te,g as ne,h as oe,l as ie,m as ae,n as re,o as ce,p as le,q as me}from"./chunk-ND2E57TF.js";import{a as Q,b as N,c as k}from"./chunk-7A5JR2EX.js";import{$a as P,Ba as A,Ea as W,Ja as E,Nb as R,Ob as H,P as $,Pb as B,Qa as M,Ta as F,Ub as D,V as T,Vb as X,Xa as a,Ya as i,Za as x,ab as b,ba as u,bb as g,ca as f,d as Ce,e as C,gb as c,hb as S,ib as v,jb as L,ob as z,qb as I,rb as w,sb as O,va as p}from"./chunk-JE4FXYSB.js";var _e=Ce(be());var V=class r{constructor(){}_indexeddbService=T(X);_highchartService=T(J);_genericService=T(D);_fb=T(ae);_categoryType=1;loadCategories(){return C(this,null,function*(){var n=new k;try{yield this._indexeddbService.getAllItems("categories","name","desc").then(e=>{n.data=e.items.filter(t=>t.type===this._categoryType),n.confirmation=!0,n.message="Categor\xEDas cargadas correctamente"},e=>{console.error(e),n.message=e.message,n.exception=e.toString()})}catch(e){console.error(e),n.message=e.message,n.exception=e.toString()}return n})}loadTable(n,e,t,o,s){return C(this,null,function*(){var d=new k;try{yield this._indexeddbService.getAllItems("transactions","created","desc").then(l=>{if(l.total>0){let h=n.search.trim().toLowerCase();e=l.items.filter(_=>_.category.type===this._categoryType&&(_.name.toLowerCase().includes(h)||_.description.toLowerCase().includes(h)||_.category.name.toLowerCase().includes(h))).map(_=>({transactionId:_.transactionId,name:_.name,amount:_.amount,amountString:this._genericService.convertToCurrencyFormat(_.amount).data,date:_.date,description:_.description,categoryId:_.categoryId,categoryName:_.category.name,categoryType:_.category.type,created:_.created})),n.total=e.length}let m=this.getChartOptions(e,t,o);m.confirmation?e.length>1&&s!==null?this._highchartService.updateChart(s,m.data):s=this._highchartService.buildChart("container",m.data):(d.message=m.message,d.exception=m.exception),d.data={partialTableOptions:n,transactions:e,categories:t,chart:s},d.confirmation=!0,d.message="Tabla cargada correctamente"},l=>{console.error(l),d.message=l.message,d.exception=l.toString()})}catch(l){console.error(l),d.message=l.message,d.exception=l.toString()}return d})}modalOpen(n,e=null){var t=new k;try{e!==null?t.data=this._fb.group({opc:["Edit"],opcLabel:["Editar"],transactionId:[e.transactionId,[y.required]],name:[e.name,[y.required]],amount:[e.amount.toString(),[y.required,j(2)]],date:[e.date,[y.required]],categoryId:[e.categoryId,[y.required]],description:[e.description]}):t.data=this._fb.group({opc:["Create"],opcLabel:["Crear"],name:["",[y.required]],amount:["0",[y.required,j(2)]],date:[this._genericService.getDateTimeNow(),[y.required]],categoryId:[n[0].categoryId,[y.required]],description:[""]}),t.confirmation=!0,t.message="Modal abierto correctamente"}catch(o){console.error(o),t.message=o.message,t.exception=o.toString()}return t}createOrUpdate(n,e){return C(this,null,function*(){var t=new N;try{let o=n.value,s=this._genericService.parseNumber(o.amount.replace(".",""));if(!s.confirmation)return t.message=s.message,t.exception=s.exception,t;let d=e.find(l=>l.categoryId===o.categoryId&&l.type===this._categoryType);if(d===void 0)return t.message="No se encontr\xF3 la categor\xEDa",t;if(o.opc==="Edit")yield this._indexeddbService.getItem("transactions",o.transactionId).then(l=>C(this,null,function*(){l.name=o.name,l.amount=s.data,l.date=new Date(o.date),l.description=o.description,l.categoryId=o.categoryId,l.category=d,yield this._indexeddbService.updateItem("transactions",l.transactionId,l).then(m=>{t.confirmation=!0,t.message="Transacci\xF3n actualizada correctamente"},m=>{console.error(m),t.message=m.message,t.exception=m.toString()})}),l=>{console.error(l),t.message=l.message,t.exception=l.toString()});else{let l={transactionId:this._genericService.generateGuid(),name:o.name,amount:s.data,date:new Date(o.date),description:o.description,categoryId:o.categoryId,category:d,created:this._genericService.getDateTimeNow()};yield this._indexeddbService.addItem("transactions",l).then(m=>{t.confirmation=!0,t.message="Transacci\xF3n creada correctamente"},m=>{console.error(m),t.message=m.message,t.exception=m.toString()})}}catch(o){console.error(o),t.message=o.message,t.exception=o.toString()}return t})}delete(n){return C(this,null,function*(){var e=new N;try{yield this._indexeddbService.deleteItem("transactions",n).then(t=>{e.confirmation=!0,e.message="Transacci\xF3n eliminada correctamente"},t=>{console.error(t),e.message=t.message,e.exception=t.toString()})}catch(t){console.error(t),e.message=t.message,e.exception=t.toString()}return e})}getChartOptions(n,e,t){var o=new k;try{let s=[],d=n.reduce((l,m)=>l+m.amount,0);for(let l=0;l<e.length;l++){let m=e[l],h=n.reduce((fe,q)=>fe+(q.categoryId===m.categoryId?q.amount:0),0),_=this._genericService.convertToCurrencyFormat(h).data,G=d>0?h*100/d:0,ue=this._genericService.parseNumber(G.toFixed(2)).data;s.push({id:m.categoryId,name:`${m.name} (${t.currency} ${_})`,y:ue,selected:!1,sliced:!1})}if(s.length>0){let l=s.reduce((m,h)=>m.y>h.y?m:h);l.name=`<b style="color: var(--color-green); font-size: 0.9rem;">${l.name}</b>`}o.data={title:{text:"Distribuci\xF3n de ingresos"},subtitle:{text:n.length>0?"":"Sin datos"},tooltip:{valueSuffix:"%"},series:n.length>0?[{type:"pie",name:"Porcentaje",showInLegend:!0,data:s}]:[]},o.confirmation=!0,o.message="Opciones del gr\xE1fico cargadas correctamente"}catch(s){console.error(s),o.message=s.message,o.exception=s.toString()}return o}static \u0275fac=function(e){return new(e||r)};static \u0275prov=$({token:r,factory:r.\u0275fac,providedIn:"root"})};function xe(r,n){if(r&1){let e=P();a(0,"div",9)(1,"h2"),c(2,"Historial"),i(),a(3,"button",10),b("click",function(){u(e);let o=g();return f(o.onOpenModal())}),c(4,"Agregar ingreso"),i(),a(5,"input",11),b("input",function(o){u(e);let s=g();return f(s.search(o))}),i()()}}function ye(r,n){r&1&&(a(0,"tr")(1,"th"),c(2,"Categor\xEDa"),i(),a(3,"th"),c(4,"Nombre"),i(),a(5,"th"),c(6,"Monto"),i(),a(7,"th"),c(8,"Fecha"),i(),a(9,"th"),c(10,"Creaci\xF3n"),i(),a(11,"th"),c(12,"OPC"),i()())}function he(r,n){if(r&1){let e=P();a(0,"tr")(1,"td"),c(2),i(),a(3,"td"),c(4),i(),a(5,"td"),c(6),i(),a(7,"td"),c(8),I(9,"date"),i(),a(10,"td"),c(11),I(12,"date"),i(),a(13,"td")(14,"div",12)(15,"button",13),b("click",function(){let o=u(e).$implicit,s=g();return f(s.onOpenModal(o))}),x(16,"i",14),i(),a(17,"button",15),b("click",function(){let o=u(e).$implicit,s=g();return f(s.onModalOpenDelete(o))}),x(18,"i",16),i()()()()}if(r&2){let e=n.$implicit,t=g();p(2),S(e.categoryName),p(2),S(e.name),p(2),L(" ",t._localStorage.currency," ",e.amountString," "),p(2),S(w(9,6,e.date,"dd/MM/yyyy hh:mm a")),p(3),S(w(12,9,e.created,"dd/MM/yyyy hh:mm a"))}}function Te(r,n){if(r&1){let e=P();a(0,"ul")(1,"li")(2,"strong"),c(3,"Categor\xEDa:"),i(),c(4),i(),a(5,"li")(6,"strong"),c(7,"Nombre:"),i(),c(8),i(),a(9,"li")(10,"strong"),c(11,"Monto:"),i(),c(12),i(),a(13,"li")(14,"strong"),c(15,"Fecha:"),i(),c(16),I(17,"date"),i(),a(18,"li")(19,"strong"),c(20,"Creaci\xF3n:"),i(),c(21),I(22,"date"),i(),a(23,"li")(24,"strong"),c(25,"OPC:"),i(),a(26,"div",12)(27,"button",13),b("click",function(){let o=u(e).$implicit,s=g();return f(s.onOpenModal(o))}),x(28,"i",14),i(),a(29,"button",15),b("click",function(){let o=u(e).$implicit,s=g();return f(s.onModalOpenDelete(o))}),x(30,"i",16),i()()()()}if(r&2){let e=n.$implicit,t=g();p(4),v(" ",e.categoryName,""),p(4),v(" ",e.name,""),p(4),L(" ",t._localStorage.currency," ",e.amountString,""),p(4),v(" ",w(17,6,e.date,"dd/MM/yyyy hh:mm a"),""),p(5),v(" ",w(22,9,e.created,"dd/MM/yyyy hh:mm a"),"")}}function ve(r,n){if(r&1&&(a(0,"h2"),c(1),i()),r&2){let e,t=g(2);p(),v("",(e=t._form.get("opcLabel"))==null?null:e.value," ingreso")}}function Me(r,n){if(r&1&&c(0),r&2){let e=n.$implicit;v(" ",e.name," ")}}function Pe(r,n){if(r&1&&(a(0,"div",19)(1,"div",20)(2,"label",21),c(3,"Nombre"),i(),x(4,"input",22),i(),a(5,"div",20)(6,"label",23),c(7,"Cantidad"),i(),x(8,"partial-inputnumber",24),i(),a(9,"div",20)(10,"label",25),c(11,"Fecha"),i(),x(12,"partial-inputdatetime",26),i(),a(13,"div",20)(14,"label",27),c(15,"Categor\xEDa"),i(),a(16,"partial-select",28),E(17,Me,1,1,"ng-template",null,2,O),i()(),a(19,"div",20)(20,"label",29),c(21,"Descripci\xF3n"),i(),x(22,"textarea",30),i()()),r&2){let e=g(2);p(8),M("_form",e._form),p(4),M("_form",e._form),p(4),M("_options",e._categories)("_form",e._form)}}function Se(r,n){if(r&1&&(a(0,"div",31)(1,"button",32),c(2),i()()),r&2){let e,t=g(2);p(),M("disabled",t._form.invalid),p(),S((e=t._form.get("opcLabel"))==null?null:e.value)}}function Ee(r,n){if(r&1){let e=P();a(0,"form",17),b("ngSubmit",function(){u(e);let o=g();return f(o.onSubmitForm(o._form))}),a(1,"partial-modal",18),b("eventCloseModal",function(){u(e);let o=g();return f(o.onCloseModal())}),E(2,ve,2,1,"ng-template",null,1,O)(4,Pe,23,4,"ng-template",null,2,O)(6,Se,3,2,"ng-template",null,4,O),i()()}if(r&2){let e=g();M("formGroup",e._form)}}function Ie(r,n){r&1&&(a(0,"h2"),c(1,"Eliminar ingreso"),i())}function we(r,n){if(r&1&&(a(0,"h4"),c(1,"\xBFEst\xE1 seguro de que desea eliminar el ingreso "),a(2,"b"),c(3),i(),c(4,"?"),i()),r&2){let e=g(2);p(3),S(e._selectedTransaction.name)}}function De(r,n){if(r&1){let e=P();a(0,"partial-modalconfirmation",33),b("eventOnSuccess",function(){u(e);let o=g();return f(o.onDelete(o._selectedTransaction))})("eventOnCancel",function(){u(e);let o=g();return o._modals.deleteTransaction=!1,f(o._selectedTransaction=null)}),E(1,Ie,2,0,"ng-template",null,1,O)(3,we,5,1,"ng-template",null,2,O),i()}}_e.setOptions(K);var ge=class r{constructor(){}_genericService=T(D);_incomesService=T(V);_form=null;_transactions=[];_selectedTransaction=null;_categories=[];_chart=null;_modals={transaction:!1,deleteTransaction:!1};_partialTableOptions={search:"",skip:0,take:5,total:0};_localStorage={currency:this._genericService.getLocalStorage("currency")||"$",language:this._genericService.getLocalStorage("language")||"es"};_totalAmountSignal=A("-");ngOnInit(){this.loadCategories()}ngAfterViewInit(){}ngOnDestroy(){}loadCategories(){return C(this,null,function*(){let n=yield this._incomesService.loadCategories();n.confirmation&&(this._categories=n.data,yield this.loadTable())})}loadTable(){return C(this,null,function*(){let n=yield this._incomesService.loadTable(this._partialTableOptions,this._transactions,this._categories,this._localStorage,this._chart);n.confirmation&&(this._partialTableOptions=n.data.partialTableOptions,this._transactions=n.data.transactions,this._categories=n.data.categories,this._chart=n.data.chart,this.loadTotalAmount())})}onOpenModal(n=null){var e=this._incomesService.modalOpen(this._categories,n);if(!e.confirmation){alert(e.message);return}this._form=e.data,this._selectedTransaction=n,this._modals.transaction=!0}onCloseModal(){this._modals.transaction=!1,this._form=null}onSubmitForm(n){return C(this,null,function*(){var e=yield this._incomesService.createOrUpdate(n,this._categories);if(!e.confirmation){alert(e.message);return}this._modals.transaction=!1,this.loadTable()})}onModalOpenDelete(n){this._selectedTransaction=n,this._modals.deleteTransaction=!0}onDelete(n){return C(this,null,function*(){let e=yield this._incomesService.delete(n.transactionId);if(!e.confirmation){alert(e.message);return}this._modals.deleteTransaction=!1,this.loadTable()})}loadTotalAmount(){let n=this._genericService.convertToCurrencyFormat(this._transactions.reduce((e,t)=>e+t.amount,0));n.confirmation&&this._totalAmountSignal.set(`${this._localStorage.currency} ${n.data}`)}onLoadPartialTable(n){this._partialTableOptions=n}onChangePartialTable(n){this._partialTableOptions=n,this.loadTable()}search(n){this._partialTableOptions.search=n.target.value,this.loadTable()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=W({type:r,selectors:[["app-incomes"]],features:[z([V,D,R,H])],decls:16,vars:5,consts:[["caption",""],["header",""],["body",""],["bodyMobile",""],["footer",""],[1,"card"],[3,"eventOnLoad","eventOnChange","_values","_options"],["id","container"],[3,"formGroup"],[1,"caption"],["type","button",1,"btn","success",3,"click"],["type","text","placeholder","Busqueda rapida...",3,"input"],[1,"operations"],["type","button","title","Editar",1,"btn","primary",3,"click"],[1,"pi","pi-pen-to-square"],["type","button","title","Eliminar",1,"btn","danger",3,"click"],[1,"pi","pi-trash"],[3,"ngSubmit","formGroup"],[3,"eventCloseModal"],[1,"form"],[1,"form-group"],["for","name"],["type","text","formControlName","name","id","name","name","name","autocomplete","off","required",""],["for","amount"],["_id","amount","_formControlName","amount","_autocomplete","off",3,"_form"],["for","date"],["_formControlName","date","_autocomplete","off",3,"_form"],["for","category"],["_formControlName","categoryId","_label","name","_value","categoryId",3,"_options","_form"],["for","description"],["formControlName","description","id","description","name","description","autocomplete","off"],[1,"footer"],["type","submit",1,"btn","success",3,"disabled"],[3,"eventOnSuccess","eventOnCancel"]],template:function(e,t){if(e&1){let o=P();a(0,"section")(1,"div",5)(2,"partial-table",6),b("eventOnLoad",function(d){return u(o),f(t.onLoadPartialTable(d))})("eventOnChange",function(d){return u(o),f(t.onChangePartialTable(d))}),E(3,xe,6,0,"ng-template",null,0,O)(5,ye,13,0,"ng-template",null,1,O)(7,he,19,12,"ng-template",null,2,O)(9,Te,31,12,"ng-template",null,3,O),i(),c(11),i(),a(12,"div",5),x(13,"div",7),i()(),E(14,Ee,8,1,"form",8)(15,De,5,0,"partial-modalconfirmation")}e&2&&(p(2),M("_values",t._transactions)("_options",t._partialTableOptions),p(9),v(" TOTAL: ",t._totalAmountSignal()," "),p(3),F(t._modals.transaction&&t._form!==null?14:-1),p(),F(t._modals.deleteTransaction&&t._selectedTransaction!==null?15:-1))},dependencies:[B,R,re,te,Y,Z,ee,ie,U,ce,ne,oe,le,se,Q,me,pe,de],styles:["partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{width:100%;display:grid;gap:10px;view-transition-name:partial-table}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{overflow:auto;max-height:400px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]{background-color:var(--color-black);border:1px solid var(--color-black-border);min-width:100%;border-spacing:0;border-collapse:collapse;position:relative}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:var(--color-black);position:sticky;top:-1px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:10px;text-align:left;word-break:break-word;overflow-wrap:break-word}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background-color:var(--color-black-weight)}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table.partial-table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:left;word-break:break-word;overflow-wrap:break-word}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .partial-table-mobile[_ngcontent-%COMP%]{display:none;flex-direction:column}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .partial-table-mobile[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding:10px;display:flex;flex-direction:column;gap:10px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .partial-table-mobile[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]:nth-child(odd){background-color:var(--color-black-weight)}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   .partial-table-mobile[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;gap:10px}section[_ngcontent-%COMP%]{container-type:inline-size;display:flex;flex-direction:column;gap:20px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:20px;gap:5px;border-radius:10px;background-color:var(--color-black);border:1px solid var(--color-black-border);transition:padding .3s ease}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   partial-table[_ngcontent-%COMP%]{container-type:inline-size}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   partial-table[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr repeat(2,auto);align-items:center;gap:10px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   partial-table[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   partial-table[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{font-size:1.3rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   partial-table[_ngcontent-%COMP%]   span.comment[_ngcontent-%COMP%]{font-size:.8rem;color:var(--color-black-text)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   partial-table[_ngcontent-%COMP%]   .operations[_ngcontent-%COMP%]{display:flex;gap:5px;align-items:center;justify-content:center;font-size:1px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   partial-table[_ngcontent-%COMP%]   .operations[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px 10px;font-size:.8rem!important}@container (width <= 600px){section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   partial-table[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{grid-template-columns:1fr}}@container (width <= 600px){section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{padding:10px!important}}form[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}form[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1.1rem}form[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"]})};export{ge as IncomesComponent};
