import{a as $,b as W,c as A,d as z,e as B}from"./chunk-KFZ7FFRB.js";import{$a as F,Ea as P,Hb as f,Ib as N,Ja as I,Jb as V,Ob as S,Pb as j,Qa as M,V as _,Wa as e,Xa as t,Ya as D,_a as H,ab as R,ba as T,ca as C,d as U,fb as n,gb as u,hb as x,ib as k,jb as w,lb as O,mb as E,nb as v,va as c}from"./chunk-TMKJNMGQ.js";var L=U(W());function Y(l,a){l&1&&(e(0,"h2"),n(1,"Ultimos movimientos"),t())}function q(l,a){l&1&&(e(0,"tr")(1,"th"),n(2,"Categor\xEDa"),t(),e(3,"th"),n(4,"Nombre"),t(),e(5,"th"),n(6,"Monto"),t(),e(7,"th"),n(8,"Fecha"),t(),e(9,"th"),n(10,"Descripci\xF3n"),t(),e(11,"th"),n(12,"Creaci\xF3n"),t()())}function J(l,a){if(l&1&&(e(0,"tr")(1,"td"),n(2),t(),e(3,"td"),n(4),t(),e(5,"td"),n(6),t(),e(7,"td"),n(8),O(9,"date"),t(),e(10,"td"),n(11),t(),e(12,"td"),n(13),O(14,"date"),t()()),l&2){let o=a.$implicit,i=R();c(2),u(o.categoryName),c(2),u(o.name),c(2),k("$",o.categoryType===1?"":"-","",i._genericService.convertToCurrencyFormat(o.amount).data,""),c(2),u(E(9,7,o.date,"dd/MM/yyyy hh:mm a")),c(3),u(o.description),c(2),u(E(14,10,o.created,"dd/MM/yyyy hh:mm a"))}}L.setOptions(z);var G=class l{constructor(){}_genericService=_(S);_highchartService=_(A);_indexeddbService=_(j);_transactions=[];_categories=[];_results={incomes:[],expenses:[],totalIncomes:"0",totalExpenses:"0",total:"0"};_options={search:"",skip:0,take:5,total:0};chart=null;ngOnInit(){this.loadTable()}ngAfterViewInit(){}ngOnDestroy(){}loadTable(){this._indexeddbService.getAllItems("transactions","created","desc").then(a=>{a.total>0&&(this._options.total=a.total,this._transactions=a.items.map(i=>({transactionId:i.transactionId,name:i.name,amount:i.amount,date:i.date,description:i.description,categoryId:i.categoryId,categoryName:i.category.name,categoryType:i.category.type,created:i.created})));let o=this.getChartOptions();this._transactions.length>1&&this.chart!==null?this._highchartService.updateChart(this.chart,o):this.chart=this._highchartService.buildChart("container",o)},a=>{console.error(a)})}updateResults(){let a=this._transactions.filter(m=>m.categoryType===1),o=this._transactions.filter(m=>m.categoryType===2),i=a.reduce((m,h)=>m+h.amount,0),p=o.reduce((m,h)=>m+h.amount,0),s=this._genericService.convertToCurrencyFormat(i);if(!s.confirmation){alert(s.message);return}let r=this._genericService.convertToCurrencyFormat(p);if(!r.confirmation){alert(r.message);return}let g=this._genericService.convertToCurrencyFormat(i-p);if(!g.confirmation){alert(g.message);return}this._results.incomes=a,this._results.expenses=o,this._results.totalIncomes=s.data,this._results.totalExpenses=r.data,this._results.total=g.data}getChartOptions(){let a=[],o=[],i=this._genericService.getMonthsFromYear(2025);for(let s=0;s<i.length;s++){let r=i[s],g=this._transactions.reduce((y,d)=>y+(d.categoryType===1&&d.date>=r.dateStart&&d.date<=r.dateEnd?d.amount:0),0),m=this._transactions.reduce((y,d)=>y+(d.categoryType===2&&d.date>=r.dateStart&&d.date<=r.dateEnd?d.amount:0),0),h=this._genericService.convertToNumberDecimal(g);if(!h.confirmation)continue;let b=this._genericService.convertToNumberDecimal(m);b.confirmation&&(a.push({name:r.name,y:h.data}),o.push({name:r.name,y:b.data}))}let p=[{name:"Ingresos",data:a,color:"#00C853"},{name:"Gastos",data:o,color:"#FF0000"}];return{chart:{type:"column"},title:{text:"Rendimiento del a\xF1o"},xAxis:{categories:i.map(s=>s.name),crosshair:!0,accessibility:{description:"Countries"}},yAxis:{min:0,title:{text:"A\xD1O 2025"}},plotOptions:{column:{pointPadding:.2,borderWidth:0}},tooltip:{valuePrefix:"$"},series:p}}loadPartialTable(a){this._options=a,this.loadTable()}changePartialTable(a){this._options=a,this.loadTable()}static \u0275fac=function(o){return new(o||l)};static \u0275cmp=P({type:l,selectors:[["app-home"]],features:[w([f,N,S])],decls:39,vars:4,consts:[["caption",""],["header",""],["body",""],[1,"card"],[1,"title"],[1,"balance"],[1,"comment"],["id","container"],[3,"eventOnLoad","eventOnChange","_values"]],template:function(o,i){if(o&1){let p=H();e(0,"section")(1,"div",3)(2,"span",4),n(3,"Balance total"),t(),e(4,"h3",5),n(5),t(),e(6,"span",6),n(7,"+20.1% del mes pasado"),t()(),e(8,"div",3)(9,"span",4),n(10,"Ingresos del Mes"),t(),e(11,"h3",5),n(12),t(),e(13,"span",6),n(14,"+8.2% del mes pasado"),t()(),e(15,"div",3)(16,"span",4),n(17,"Gastos del Mes"),t(),e(18,"h3",5),n(19),t(),e(20,"span",6),n(21,"-4.5% del mes pasado"),t()(),e(22,"div",3)(23,"span",4),n(24,"Rendimiento"),t(),e(25,"h3",5),n(26,"+18.2%"),t(),e(27,"span",6),n(28,"+4.1% del mes pasado"),t()(),e(29,"div",3),D(30,"div",7),t(),e(31,"div",3)(32,"partial-table",8),F("eventOnLoad",function(r){return T(p),C(i.loadPartialTable(r))})("eventOnChange",function(r){return T(p),C(i.changePartialTable(r))}),I(33,Y,2,0,"ng-template",null,0,v)(35,q,13,0,"ng-template",null,1,v)(37,J,15,13,"ng-template",null,2,v),t()()()}o&2&&(c(5),x("$",i._results.total,""),c(7),x("$",i._results.totalIncomes,""),c(7),x("$",i._results.totalExpenses,""),c(13),M("_values",i._transactions))},dependencies:[V,f,$,B],styles:["section[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);gap:20px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:20px;gap:5px;border-radius:10px;background-color:var(--color-black);border:1px solid var(--color-black-border)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:is(:nth-child(5),:nth-child(6)){grid-column:span 2}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.6rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{font-size:1.3rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.comment[_ngcontent-%COMP%]{font-size:.8rem;color:var(--color-black-text)}"]})};export{G as HomeComponent};
