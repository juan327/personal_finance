import{a as ae,b as Te,c as Y,d as ie,e as oe}from"./chunk-6IPNF77S.js";import{a as re,d as se,f as le,j as de,k as me,l as pe,o as ge}from"./chunk-3W7ZN6ZC.js";import{$a as Q,Ea as $,Ja as j,Mb as R,Nb as te,Ob as ne,P as B,Qa as F,Sa as w,Ta as z,Ua as G,V as T,Va as q,Vb as C,Wa as J,Wb as I,Xa as s,Xb as ce,Ya as i,Za as K,ab as N,ba as b,bb as _,ca as D,d as ye,e as g,gb as r,hb as d,ib as u,jb as H,kb as k,lb as U,mb as X,nb as Z,ob as ee,qb as S,rb as P,sb as M,va as a}from"./chunk-XT66FLIC.js";var ue=ye(Te());var L=class{incomes;expenses;totalIncomes;totalExpenses;total;totalInt;constructor(){this.incomes=[],this.expenses=[],this.totalIncomes="0",this.totalExpenses="0",this.total="0",this.totalInt=0}};var E=class l{constructor(){}_indexeddbService=T(ce);_highchartService=T(Y);_genericService=T(I);loadYears(){return g(this,null,function*(){var t=new C;try{yield this._indexeddbService.getAllItems("transactions","created","desc").then(e=>{t.confirmation=!0,e.total>0?t.data=[...new Set(e.items.map(n=>n.date.getFullYear()))].sort((n,o)=>o-n):t.data=[new Date().getFullYear()],t.message="A\xF1os cargados correctamente"},e=>{console.error(e),t.message=e.message,t.exception=e.toString()})}catch(e){console.error(e),t.message=e.message,t.exception=e.toString()}return t})}loadTable(t){return g(this,null,function*(){var e=new C;try{yield this._indexeddbService.getAllItems("transactions","created","desc").then(n=>{n.total>0&&(t._partialTableOptions.total=n.total,t._transactions=n.items.map(c=>({transactionId:c.transactionId,name:c.name,amount:c.amount,amountString:`${t._localStorage.currency} ${this._genericService.convertToCurrencyFormat(c.amount).data}`,date:c.date,description:c.description,categoryId:c.categoryId,categoryName:c.category.name,categoryType:c.category.type,created:c.created})));let o=this.getChartOptions(t._transactions,t._localStorage,t._selectedYear,t._dictionary);o.confirmation?t._transactions.length>1&&t._chart!==null?this._highchartService.updateChart(t._chart,o.data):t._chart=this._highchartService.buildChart("chart",o.data):(e.message=o.message,e.exception=o.exception),e.data={partialTableOptions:t._partialTableOptions,transactions:t._transactions,categories:t._categories,chart:t._chart},e.confirmation=!0,e.message="Tabla cargada correctamente"},n=>{console.error(n)})}catch(n){console.error(n),e.message=n.message,e.exception=n.toString()}return e})}updateResults(t,e){var n=new C;try{let o=e.filter(m=>m.categoryType===1),c=e.filter(m=>m.categoryType===2),p=o.reduce((m,v)=>m+v.amount,0),x=c.reduce((m,v)=>m+v.amount,0),O=this._genericService.convertToCurrencyFormat(p);if(!O.confirmation)return alert(O.message),n;let f=this._genericService.convertToCurrencyFormat(x);if(!f.confirmation)return alert(f.message),n;let h=this._genericService.convertToCurrencyFormat(p-x);if(!h.confirmation)return alert(h.message),n;n.data={incomes:o,expenses:c,totalIncomes:O.data,totalExpenses:f.data,total:h.data,totalInt:p-x},n.confirmation=!0,n.message="Resultados cargados correctamente"}catch(o){console.error(o),n.message=o.message,n.exception=o.toString()}return n}getChartOptions(t,e,n,o){var c=new C;try{let p=[],x=[],O=this._genericService.getMonthsFromYear(n);for(let h=0;h<O.length;h++){let m=O[h],v=t.reduce((W,y)=>W+(y.categoryType===1&&y.date>=m.dateStart&&y.date<=m.dateEnd?y.amount:0),0),he=t.reduce((W,y)=>W+(y.categoryType===2&&y.date>=m.dateStart&&y.date<=m.dateEnd?y.amount:0),0),V=this._genericService.convertToNumberDecimal(v);if(!V.confirmation)continue;let A=this._genericService.convertToNumberDecimal(he);A.confirmation&&(p.push({name:m.name,y:V.data}),x.push({name:m.name,y:A.data}))}let f=[{name:o.cardChart.incomes,data:p,color:"var(--color-green)"},{name:o.cardChart.expenses,data:x,color:"var(--color-red)"}];c.data={chart:{type:"column"},title:{text:o.cardChart.title},xAxis:{categories:O.map(h=>h.name),crosshair:!0,accessibility:{description:"Countries"}},yAxis:{min:0,title:{text:`${o.cardChart.leftText} ${n}`}},plotOptions:{column:{pointPadding:.2,borderWidth:0}},tooltip:{valuePrefix:e.currency+" "},series:f},c.confirmation=!0,c.message="Opciones del gr\xE1fico cargadas correctamente"}catch(p){console.error(p),c.message=p.message,c.exception=p.toString()}return c}getDictionary(t){return g(this,null,function*(){var e=new C;try{e=yield this._genericService.getDictionary(`home/${t.language}.json`)}catch(n){console.error(n),e.message=n.message,e.exception=n.toString()}return e})}static \u0275fac=function(e){return new(e||l)};static \u0275prov=B({token:l,factory:l.\u0275fac,providedIn:"root"})};function xe(l,t){if(l&1&&(s(0,"option",17),r(1),i()),l&2){let e=t.$implicit;F("value",e),a(),d(e)}}function Ce(l,t){if(l&1&&(s(0,"h2"),r(1),i()),l&2){let e=_(2);a(),d(e._dictionary.cardTitleTable)}}function fe(l,t){if(l&1&&(s(0,"tr")(1,"th"),r(2),i(),s(3,"th"),r(4),i(),s(5,"th"),r(6),i(),s(7,"th"),r(8),i(),s(9,"th"),r(10),i()()),l&2){let e=_(2);a(2),d(e._dictionary.cardHeaderTable.category),a(2),d(e._dictionary.cardHeaderTable.name),a(2),d(e._dictionary.cardHeaderTable.amount),a(2),d(e._dictionary.cardHeaderTable.date),a(2),d(e._dictionary.cardHeaderTable.created)}}function ve(l,t){if(l&1&&(s(0,"tr")(1,"td"),r(2),i(),s(3,"td"),r(4),i(),s(5,"td"),r(6),i(),s(7,"td"),r(8),S(9,"date"),i(),s(10,"td"),r(11),S(12,"date"),i()()),l&2){let e=t.$implicit,n=_(2);w(e.categoryType===1?"income":"expense"),a(2),d(e.categoryName),a(2),d(e.name),a(2),k(" ",n._localStorage.currency," ",e.categoryType===1?"":"-","",n._genericService.convertToCurrencyFormat(e.amount).data," "),a(2),d(P(9,9,e.date,"dd/MM/yyyy hh:mm a")),a(3),d(P(12,12,e.created,"dd/MM/yyyy hh:mm a"))}}function be(l,t){if(l&1&&(s(0,"ul")(1,"li")(2,"strong"),r(3),i(),r(4),i(),s(5,"li")(6,"strong"),r(7),i(),r(8),i(),s(9,"li")(10,"strong"),r(11),i(),r(12),i(),s(13,"li")(14,"strong"),r(15),i(),r(16),S(17,"date"),i(),s(18,"li")(19,"strong"),r(20),i(),r(21),S(22,"date"),i()()),l&2){let e=t.$implicit,n=_(2);w(e.categoryType===1?"income":"expense"),a(3),u("",n._dictionary.cardHeaderTable.category,":"),a(),u(" ",e.categoryName,""),a(3),u("",n._dictionary.cardHeaderTable.name,":"),a(),u(" ",e.name,""),a(3),u("",n._dictionary.cardHeaderTable.amount,":"),a(),k(" ",n._localStorage.currency," ",e.categoryType===1?"":"-","",n._genericService.convertToCurrencyFormat(e.amount).data,""),a(3),u("",n._dictionary.cardHeaderTable.date,":"),a(),u(" ",P(17,14,e.date,"dd/MM/yyyy hh:mm a"),""),a(4),u("",n._dictionary.cardHeaderTable.created,":"),a(),u(" ",P(22,17,e.created,"dd/MM/yyyy hh:mm a"),"")}}function De(l,t){if(l&1){let e=Q();s(0,"section")(1,"div",4)(2,"div",5)(3,"span",6),r(4),i(),s(5,"h3",7),r(6),i()(),s(7,"div",8)(8,"span",6),r(9),i(),s(10,"h3",9),r(11),i()(),s(12,"div",10)(13,"span",6),r(14),i(),s(15,"h3",11),r(16),i()()(),s(17,"div",12)(18,"div",13)(19,"div",14)(20,"label",15),r(21),i(),s(22,"select",16),Z("ngModelChange",function(o){b(e);let c=_();return X(c._selectedYear,o)||(c._selectedYear=o),D(o)}),N("change",function(o){b(e);let c=_();return D(c.changeYear(o))}),q(23,xe,2,2,"option",17,G),i()()(),K(25,"hr")(26,"div",18),i(),s(27,"div",12)(28,"partial-table",19),N("eventOnLoad",function(o){b(e);let c=_();return D(c.loadPartialTable(o))})("eventOnChange",function(o){b(e);let c=_();return D(c.changePartialTable(o))}),j(29,Ce,2,1,"ng-template",null,0,M)(31,fe,11,5,"ng-template",null,1,M)(33,ve,13,15,"ng-template",null,2,M)(35,be,23,20,"ng-template",null,3,M),i()()()}if(l&2){let e=_();a(4),d(e._dictionary.cardTotal),a(),w(e._results.totalInt>=0?"income":"expense"),a(),H(" ",e._localStorage.currency," ",e._results.total," "),a(3),d(e._dictionary.cardTotalIncomes),a(2),H(" ",e._localStorage.currency," ",e._results.totalIncomes," "),a(3),d(e._dictionary.cardTotalExpenses),a(2),H(" ",e._localStorage.currency," ",e._results.totalExpenses," "),a(5),d(e._dictionary.cardYear),a(),U("ngModel",e._selectedYear),a(),J(e._listYears),a(5),F("_values",e._transactions)("_options",e._partialTableOptions)}}ue.setOptions(ie);var _e=class l{constructor(){}_genericService=T(I);_highchartService=T(Y);_homeService=T(E);_transactions=[];_categories=[];_results=new L;_partialTableOptions=new oe;_chart=null;_localStorage=this._genericService.getDataLocalStorage();_dictionary=null;_listYears=[];_selectedYear=0;ngOnInit(){return g(this,null,function*(){yield this.loadDictionary(),yield this.loadYears(),yield this.loadTable()})}ngAfterViewInit(){}ngOnDestroy(){}loadDictionary(){return g(this,null,function*(){let t=yield this._homeService.getDictionary(this._localStorage);t.confirmation&&(this._dictionary=t.data)})}loadYears(){return g(this,null,function*(){let t=yield this._homeService.loadYears();t.confirmation&&(t.data.length<=0||(this._listYears=t.data,this._selectedYear=this._listYears[0]))})}loadTable(){return g(this,null,function*(){if(this._dictionary===null)return;let t=yield this._homeService.loadTable({_partialTableOptions:this._partialTableOptions,_transactions:this._transactions,_categories:this._categories,_localStorage:this._localStorage,_chart:this._chart,_selectedYear:this._selectedYear,_dictionary:this._dictionary});t.confirmation&&(this._partialTableOptions=t.data.partialTableOptions,this._transactions=t.data.transactions,this._categories=t.data.categories,this._chart=t.data.chart,this.updateResults())})}updateResults(){return g(this,null,function*(){let t=yield this._homeService.updateResults(this._results,this._transactions);t.confirmation&&(this._results=t.data)})}loadPartialTable(t){this._partialTableOptions=t,this.loadTable()}changePartialTable(t){this._partialTableOptions=t,this.loadTable()}changeYear(t){this._selectedYear=parseInt(t.target.value),this.loadTable()}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=$({type:l,selectors:[["app-home"]],features:[ee([E,R,te,I])],decls:1,vars:1,consts:[["caption",""],["header",""],["body",""],["bodyMobile",""],[1,"widgets"],[1,"card","total"],[1,"title"],[1,"balance"],[1,"card","total-incomes"],[1,"balance","income"],[1,"card","total-expenses"],[1,"balance","expense"],[1,"card"],[1,"year"],[1,"form-group"],["for","year"],["name","year","id","year",3,"ngModelChange","change","ngModel"],[3,"value"],["id","chart"],[3,"eventOnLoad","eventOnChange","_values","_options"]],template:function(e,n){e&1&&j(0,De,37,15,"section"),e&2&&z(n._dictionary!==null?0:-1)},dependencies:[ne,R,ae,re,ge,me,pe,de,se,le],styles:["section[_ngcontent-%COMP%]{container-type:inline-size;display:flex;flex-direction:column;gap:20px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:20px;gap:5px;border-radius:10px;background-color:var(--color-black);border:1px solid var(--color-black-border)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   partial-table[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{text-align:center}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .year[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .year[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;gap:5px;align-items:center;justify-content:center}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .year[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{white-space:nowrap}section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.6rem}section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem}section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{font-size:1.3rem}section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.comment[_ngcontent-%COMP%]{font-size:.8rem;color:var(--color-black-text)}section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .balance.income[_ngcontent-%COMP%]{color:var(--color-green)}section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .balance.expense[_ngcontent-%COMP%]{color:var(--color-red)}@container (width <= 700px){section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:last-child{grid-column:span 2}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{padding:10px!important}}@container (width <= 500px){section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]{grid-template-columns:1fr}section[_ngcontent-%COMP%]   .widgets[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]:last-child{grid-column:initial}}[_ngcontent-%COMP%]:is(tr,ul).income{background-color:#86efac33!important}[_ngcontent-%COMP%]:is(tr,ul).income:nth-child(odd){background-color:#47d47a33!important}[_ngcontent-%COMP%]:is(tr,ul).expense{background-color:#f663!important}[_ngcontent-%COMP%]:is(tr,ul).expense:nth-child(odd){background-color:#f003!important}"]})};export{_e as HomeComponent};
