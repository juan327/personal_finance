import{a as B,b as p,c as U,d as J,e as K,f as Q,g as W,h as X,i as Y,j as Z,k as ee,l as te,m as ne,n as ie,o as oe,p as ae,q as w,r as re}from"./chunk-NLWQZ4SQ.js";import{a as G,b as pe,c as $,d as z,e as j}from"./chunk-KFZ7FFRB.js";import{$a as f,Ea as k,Hb as E,Ib as L,Ja as y,Jb as A,Ob as I,Pb as H,Qa as v,Sa as P,Ta as F,Ua as N,V as O,Va as R,Wa as o,Xa as i,Ya as x,_a as b,ab as d,ba as _,ca as g,d as de,e as V,fb as l,gb as C,hb as M,jb as q,lb as T,mb as S,nb as u,va as m}from"./chunk-TMKJNMGQ.js";var ce=de(pe());function _e(r,t){if(r&1){let e=b();o(0,"div",8)(1,"h2"),l(2,"Historial"),i(),o(3,"button",9),f("click",function(){_(e);let a=d();return g(a.openModal())}),l(4,"Agregar gasto"),i()()}}function ge(r,t){r&1&&(o(0,"tr")(1,"th"),l(2,"Categor\xEDa"),i(),o(3,"th"),l(4,"Nombre"),i(),o(5,"th"),l(6,"Monto"),i(),o(7,"th"),l(8,"Fecha"),i(),o(9,"th"),l(10,"Descripci\xF3n"),i(),o(11,"th"),l(12,"Creaci\xF3n"),i(),o(13,"th"),l(14,"OPC"),i()())}function ue(r,t){if(r&1){let e=b();o(0,"tr")(1,"td"),l(2),i(),o(3,"td"),l(4),i(),o(5,"td"),l(6),i(),o(7,"td"),l(8),T(9,"date"),i(),o(10,"td"),l(11),i(),o(12,"td"),l(13),T(14,"date"),i(),o(15,"td")(16,"div",10)(17,"button",11),f("click",function(){let a=_(e).$implicit,s=d();return g(s.openModal(a))}),x(18,"i",12),i(),o(19,"button",13),f("click",function(){let a=_(e).$implicit,s=d();return g(s.modalOpenDelete(a))}),x(20,"i",14),i()()()()}if(r&2){let e=t.$implicit,n=d();m(2),C(e.categoryName),m(2),C(e.name),m(2),M("$",n._genericService.convertToCurrencyFormat(e.amount).data,""),m(2),C(S(9,6,e.date,"dd/MM/yyyy hh:mm a")),m(3),C(e.description),m(2),C(S(14,9,e.created,"dd/MM/yyyy hh:mm a"))}}function fe(r,t){if(r&1){let e=b();o(0,"button",9),f("click",function(){_(e);let a=d();return g(a.openModal())}),l(1,"Agregar gasto"),i()}}function Ce(r,t){if(r&1&&(o(0,"h2"),l(1),i()),r&2){let e,n=d(2);m(),M("",(e=n._form.get("opcLabel"))==null?null:e.value," gasto")}}function xe(r,t){if(r&1&&(o(0,"option",27),l(1),i()),r&2){let e=t.$implicit;v("value",e.categoryId),m(),C(e.name)}}function be(r,t){if(r&1&&(o(0,"div",17)(1,"div",18)(2,"label",19),l(3,"Nombre"),i(),x(4,"input",20),i(),o(5,"div",18)(6,"label",21),l(7,"Cantidad"),i(),x(8,"partial-inputnumber",22),i(),o(9,"div",18)(10,"label",23),l(11,"Fecha"),i(),x(12,"input",24),i(),o(13,"div",18)(14,"label",25),l(15,"Categor\xEDa"),i(),o(16,"select",26),N(17,xe,2,2,"option",27,F),i()(),o(19,"div",18)(20,"label",28),l(21,"Descripci\xF3n"),i(),x(22,"textarea",29),i()()),r&2){let e=d(2);m(17),R(e._categories)}}function he(r,t){if(r&1&&(o(0,"div",30)(1,"button",31),l(2),i()()),r&2){let e,n=d(2);m(),v("disabled",n._form.invalid),m(),C((e=n._form.get("opcLabel"))==null?null:e.value)}}function Oe(r,t){if(r&1){let e=b();o(0,"form",15),f("ngSubmit",function(){_(e);let a=d();return g(a.submitForm(a._form))}),o(1,"partial-modal",16),f("eventCloseModal",function(){_(e);let a=d();return g(a.closeModal())}),y(2,Ce,2,1,"ng-template",null,1,u)(4,be,23,0,"ng-template",null,2,u)(6,he,3,2,"ng-template",null,3,u),i()()}if(r&2){let e=d();v("formGroup",e._form)}}function ye(r,t){r&1&&(o(0,"h2"),l(1,"Eliminar gasto"),i())}function ve(r,t){if(r&1&&(o(0,"h4"),l(1,"\xBFEst\xE1 seguro de que desea eliminar el gasto "),o(2,"b"),l(3),i(),l(4,"?"),i()),r&2){let e=d(2);m(3),C(e._selectedIncome.name)}}function Me(r,t){if(r&1){let e=b();o(0,"partial-modalconfirmation",32),f("eventOnSuccess",function(){_(e);let a=d();return g(a.onDelete(a._selectedIncome))})("eventOnCancel",function(){_(e);let a=d();return a._modals.deleteIncome=!1,g(a._selectedIncome=null)}),y(1,ye,2,0,"ng-template",null,1,u)(3,ve,5,1,"ng-template",null,2,u),i()}}ce.setOptions(z);var le=class r{constructor(){}_genericService=O(I);_highchartService=O($);_indexeddbService=O(H);_modals={income:!1,deleteIncome:!1};_fb=O(te);_form=null;_incomes=[];_selectedIncome=null;_categories=[];chart=null;_categoryType=2;_options={search:"",skip:0,take:5,total:0};ngOnInit(){this._indexeddbService.getAllItems("categories","name","asc").then(t=>{t.total>0&&(this._categories=t.items.filter(e=>e.type===this._categoryType),this.loadTable())},t=>{console.error(t)})}ngAfterViewInit(){}ngAfterContentInit(){}ngOnDestroy(){}loadTable(){this._indexeddbService.getAllItems("transactions","created","desc").then(t=>{t.total>0&&(this._options.total=t.total,this._incomes=t.items.filter(n=>n.category.type===this._categoryType).map(n=>({transactionId:n.transactionId,name:n.name,amount:n.amount,date:n.date,description:n.description,categoryId:n.categoryId,categoryName:n.category.name,categoryType:n.category.type,created:n.created})));let e=this.getChartOptions();this._incomes.length>1&&this.chart!==null?this._highchartService.updateChart(this.chart,e):this.chart=this._highchartService.buildChart("container",e)},t=>{console.error(t)})}openModal(t=null){t!==null?(this._selectedIncome=t,this._form=this._fb.group({opc:["Edit"],opcLabel:["Editar"],transactionId:[t.transactionId],name:[t.name,[p.required,p.minLength(3),p.maxLength(20)]],amount:[this._genericService.convertToCurrencyFormat(t.amount).data,[p.required,w(2)]],date:[this._genericService.transformDateToString(t.date),p.required],categoryId:[t.categoryId,p.required],description:[t.description]})):this._form=this._fb.group({opc:["Create"],opcLabel:["Crear"],name:["",[p.required,p.minLength(3),p.maxLength(20)]],amount:["",[p.required,w(2)]],date:[this._genericService.transformDateToString(this._genericService.getDateTimeNowUtc()),p.required],categoryId:[this._categories[0].categoryId,p.required],description:[""]}),this._modals.income=!0}closeModal(){this._modals.income=!1,this._form=null}submitForm(t){return V(this,null,function*(){let e=t.value,n=this._genericService.parseNumber(e.amount.replace(".",""));if(!n.confirmation){alert(n.message);return}let a=this._categories.find(s=>s.categoryId===e.categoryId&&s.type===this._categoryType);if(a===void 0){alert("No se encontr\xF3 la categor\xEDa");return}if(e.opc==="Edit"){let c=(yield this._indexeddbService.getAllItems("transactions","created","asc")).items.find(h=>h.transactionId===e.transactionId);if(c===void 0){alert("No se encontr\xF3 la transacci\xF3n");return}c.name=e.name,c.amount=n.data,c.date=new Date(e.date),c.description=e.description,c.categoryId=e.categoryId,c.category=a,this._indexeddbService.updateItem("transactions",c.transactionId,c).then(h=>{this._modals.income=!1,this.loadTable()},h=>{console.error(h)})}else{let s={transactionId:this._genericService.generateGuid(),name:e.name,amount:n.data,date:new Date(e.date),description:e.description,categoryId:e.categoryId,category:a,created:new Date};this._indexeddbService.addItem("transactions",s).then(c=>{this._modals.income=!1,this.loadTable()},c=>{console.error(c)})}})}modalOpenDelete(t){this._selectedIncome=t,this._modals.deleteIncome=!0}onDelete(t){this._indexeddbService.deleteItem("transactions",t.transactionId).then(e=>{this._modals.deleteIncome=!1,this.loadTable()},e=>{console.error(e)})}getTotal(){return this._incomes.reduce((t,e)=>t+e.amount,0)}getChartOptions(){let t=[],e=this._incomes.reduce((n,a)=>n+a.amount,0);for(let n=0;n<this._categories.length;n++){let a=this._categories[n],s=this._incomes.reduce((me,D)=>me+(D.categoryId===a.categoryId?D.amount:0),0),c=this._genericService.convertToCurrencyFormat(s).data,h=e>0?s*100/e:0,se=this._genericService.parseNumber(h.toFixed(2)).data;t.push({id:a.categoryId,name:`${a.name} ($${c})`,y:se,selected:!1,sliced:!1})}if(t.length>0){let n=t.reduce((a,s)=>a.y>s.y?a:s);n.name=`<b style="color: var(--color-green); font-size: 0.9rem;">${n.name}</b>`}return{title:{text:"Distribuci\xF3n de gastos"},subtitle:{text:this._incomes.length>0?"":"Sin datos"},tooltip:{valueSuffix:"%"},series:this._incomes.length>0?[{type:"pie",name:"Porcentaje",showInLegend:!0,data:t}]:[]}}loadPartialTable(t){this._options=t,this.loadTable()}changePartialTable(t){this._options=t,this.loadTable()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=k({type:r,selectors:[["app-expenses"]],features:[q([I,E,L])],decls:16,vars:4,consts:[["caption",""],["header",""],["body",""],["footer",""],[1,"card"],[3,"eventOnLoad","eventOnChange","_values"],["id","container"],[3,"formGroup"],[1,"buttons"],["type","button",1,"btn","success",3,"click"],[1,"operations"],["type","button","title","Editar",1,"btn","primary",3,"click"],[1,"pi","pi-pen-to-square"],["type","button","title","Eliminar",1,"btn","danger",3,"click"],[1,"pi","pi-trash"],[3,"ngSubmit","formGroup"],[3,"eventCloseModal"],[1,"form"],[1,"form-group"],["for","name"],["type","text","formControlName","name","id","name","name","name","autocomplete","off","required",""],["for","amount"],["formControlName","amount","autocomplete","off"],["for","date"],["type","date","formControlName","date","id","date","name","date","autocomplete","off","required",""],["for","category"],["formControlName","categoryId","id","category","name","category","required",""],[3,"value"],["for","description"],["formControlName","description","id","description","name","description","autocomplete","off"],[1,"footer"],["type","submit",1,"btn","success",3,"disabled"],[3,"eventOnSuccess","eventOnCancel"]],template:function(e,n){if(e&1){let a=b();o(0,"section")(1,"div",4)(2,"partial-table",5),f("eventOnLoad",function(c){return _(a),g(n.loadPartialTable(c))})("eventOnChange",function(c){return _(a),g(n.changePartialTable(c))}),y(3,_e,5,0,"ng-template",null,0,u)(5,ge,15,0,"ng-template",null,1,u)(7,ue,21,12,"ng-template",null,2,u)(9,fe,2,0,"ng-template",null,3,u),i(),l(11),i(),o(12,"div",4),x(13,"div",6),i()(),y(14,Oe,8,1,"form",7)(15,Me,5,0,"partial-modalconfirmation")}e&2&&(m(2),v("_values",n._incomes),m(9),M(" TOTAL: $",n._genericService.convertToCurrencyFormat(n.getTotal()).data," "),m(3),P(n._modals.income&&n._form!==null?14:-1),m(),P(n._modals.deleteIncome&&n._selectedIncome!==null?15:-1))},dependencies:[A,E,ne,K,Y,Z,B,X,U,J,ee,G,ie,Q,W,oe,ae,j,re],styles:["partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]{width:100%;display:grid}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .caption[_ngcontent-%COMP%]{padding:10px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]{overflow:auto;max-height:400px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]{background-color:var(--color-black);border:1px solid var(--color-black-border);min-width:100%;border-spacing:0;border-collapse:collapse;position:relative}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{background-color:var(--color-black);position:sticky;top:-1px}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:10px;text-align:left;word-break:break-word;overflow-wrap:break-word}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:nth-child(odd){background-color:var(--color-black-weight)}partial-table[_ngcontent-%COMP%]   .container[_ngcontent-%COMP%]   .body[_ngcontent-%COMP%]   table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:10px;text-align:left;word-break:break-word;overflow-wrap:break-word}section[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}section[_ngcontent-%COMP%]   .buttons[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr auto;align-items:center}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding:20px;gap:5px;border-radius:10px;background-color:var(--color-black);border:1px solid var(--color-black-border)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.6rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.2rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.title[_ngcontent-%COMP%]{font-size:1.3rem}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   span.comment[_ngcontent-%COMP%]{font-size:.8rem;color:var(--color-black-text)}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .operations[_ngcontent-%COMP%]{display:flex;gap:5px;align-items:center;justify-content:center;font-size:1px}section[_ngcontent-%COMP%]   .card[_ngcontent-%COMP%]   .operations[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:5px 10px;font-size:.8rem!important}form[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%], form[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}form[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:1.1rem}form[_ngcontent-%COMP%]   .footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}"]})};export{le as ExpensesComponent};
